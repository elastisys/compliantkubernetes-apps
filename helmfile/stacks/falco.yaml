---
templates:
  falco:
    installed: {{ .Values | get "falco.enabled" false }}
    namespace: falco
    labels:
      app: falco

  falco-podsecuritypolicy:
    inherit:
      - template: falco
      - template: podsecuritypolicies
    labels:
      psp: falco
    values:
      - helmfile/values/podsecuritypolicies/common/falco.yaml.gotmpl

  falco-daemonset:
    inherit:
      - template: falco
      - template: falco-chart
    name: falco
    needs:
      - falco/podsecuritypolicy
    values:
      - helmfile/values/falco/falco-common.yaml.gotmpl
      {{ if .Values.ck8sManagementCluster.enabled }}
      - helmfile/values/falco/falco-service-cluster.yaml.gotmpl
      {{ else if .Values.ck8sWorkloadCluster.enabled }}
      - helmfile/values/falco/falco-workload-cluster.yaml.gotmpl
      {{ end }}

  falco-exporter:
    inherit:
      - template: falco
      - template: falco-exporter-chart
    name: falco-exporter
    needs:
      - falco/falco
      - falco/podsecuritypolicy
      - monitoring/kube-prometheus-stack
    values:
      - helmfile/values/falco/falco-exporter.yaml.gotmpl

---
templates:
  kured:
    namespace: kured
    labels:
      app: kured

  kured-podsecuritypolicy:
    inherit:
      - template: kured
      - template: podsecuritypolicies
    installed: {{ .Values | get "kured.enabled" false }}
    labels:
      psp: kured
    values:
      - helmfile/values/podsecuritypolicies/common/kured.yaml.gotmpl

  kured-secret:
    inherit: [ template: kured ]
    installed: {{ and (.Values | get "kured.enabled" false) (.Values | get "kured.notification.slack.enabled" false) }}
    chart: helmfile/charts/kured-secret
    version: 0.1.0
    name: kured-secret
    needs:
      - kube-system/system-namespaces
    values:
    - helmfile/values/kured.yaml.gotmpl

  kured-main:
    disableValidationOnInstall: true
    inherit:
      - template: kured
      - template: kured-chart
    installed: {{ .Values | get "kured.enabled" false }}
    name: kured
    needs:
      - kube-system/common-np
      - monitoring/kube-prometheus-stack # creates servicemonitors
    values:
      - helmfile/values/kured.yaml.gotmpl

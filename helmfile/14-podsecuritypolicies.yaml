helmDefaults:
  timeout: 600
  createNamespace: false
  skipDeps: true

environments:
  workload_cluster:
    values:
      - "{{ requiredEnv "CK8S_CONFIG_PATH" }}/defaults/common-config.yaml"
      - "{{ requiredEnv "CK8S_CONFIG_PATH" }}/defaults/wc-config.yaml"
      - "{{ requiredEnv "CK8S_CONFIG_PATH" }}/common-config.yaml"
      - "{{ requiredEnv "CK8S_CONFIG_PATH" }}/wc-config.yaml"
    secrets:
      - "{{ requiredEnv "CK8S_CONFIG_PATH" }}/secrets.yaml"
  service_cluster:
    values:
      - "{{ requiredEnv "CK8S_CONFIG_PATH" }}/defaults/common-config.yaml"
      - "{{ requiredEnv "CK8S_CONFIG_PATH" }}/defaults/sc-config.yaml"
      - "{{ requiredEnv "CK8S_CONFIG_PATH" }}/common-config.yaml"
      - "{{ requiredEnv "CK8S_CONFIG_PATH" }}/sc-config.yaml"
    secrets:
      - "{{ requiredEnv "CK8S_CONFIG_PATH" }}/secrets.yaml"
---

commonLabels:
  app: psp
  component: gatekeeper-psp

releases:
  - name: podsecuritypolicy
    namespace: falco
    labels:
      psp: falco
    chart: ./charts/gatekeeper/podsecuritypolicies
    version: 0.1.0
    installed: {{ .Values.falco.enabled }}
    values:
      - values/podsecuritypolicies/common/falco.yaml.gotmpl

  - name: podsecuritypolicy
    namespace: fluentd-system
    labels:
      psp: fluentd
    chart: ./charts/gatekeeper/podsecuritypolicies
    version: 0.1.0
    installed: {{ .Values.fluentd.enabled }}
    values:
      - values/podsecuritypolicies/common/fluentd.yaml.gotmpl

  - name: podsecuritypolicy
    namespace: ingress-nginx
    labels:
      psp: ingress-nginx
    chart: ./charts/gatekeeper/podsecuritypolicies
    version: 0.1.0
    values:
      - values/podsecuritypolicies/common/ingress-nginx.yaml.gotmpl

  - name: podsecuritypolicy
    namespace: kured
    labels:
      psp: kured
    chart: ./charts/gatekeeper/podsecuritypolicies
    version: 0.1.0
    installed: {{ .Values.kured.enabled }}
    values:
      - values/podsecuritypolicies/common/kured.yaml.gotmpl

  - name: podsecuritypolicy
    namespace: monitoring
    labels:
      psp: monitoring
    chart: ./charts/gatekeeper/podsecuritypolicies
    version: 0.1.0
    values:
      - values/podsecuritypolicies/common/monitoring.yaml.gotmpl

  - name: podsecuritypolicy
    namespace: velero
    labels:
      psp: velero
    chart: ./charts/gatekeeper/podsecuritypolicies
    version: 0.1.0
    installed: {{ .Values.velero.enabled }}
    values:
      - values/podsecuritypolicies/common/velero.yaml.gotmpl

  - name: podsecuritypolicy
    namespace: rook-ceph
    labels:
      psp: rook-ceph
    chart: ./charts/gatekeeper/podsecuritypolicies
    version: 0.1.0
    installed: {{ .Values.rookCeph.gatekeeperPsp.enabled }}
    values:
      - values/podsecuritypolicies/common/rook-ceph.yaml.gotmpl

{{- if eq .Environment.Name "service_cluster" }}
  - name: podsecuritypolicy
    namespace: harbor
    labels:
      psp: harbor
    chart: ./charts/gatekeeper/podsecuritypolicies
    version: 0.1.0
    installed: {{ .Values.harbor.enabled }}
    values:
      - values/podsecuritypolicies/service/harbor.yaml.gotmpl

  - name: podsecuritypolicy
    namespace: opensearch-system
    labels:
      psp: opensearch
    chart: ./charts/gatekeeper/podsecuritypolicies
    version: 0.1.0
    values:
      - values/podsecuritypolicies/service/opensearch.yaml.gotmpl
{{- end }}

{{- if eq .Environment.Name "workload_cluster" }}
  - name: podsecuritypolicy
    namespace: default
    labels:
      psp: default
    chart: ./charts/gatekeeper/podsecuritypolicies
    version: 0.1.0
    values:
      - values/podsecuritypolicies/workload/default.yaml.gotmpl
{{- end }}

bases:
  - ./bases/environment.yaml
---

commonLabels:
  app: netpol

releases:

- name: common-np
  namespace: kube-system
  labels:
    netpol: common
  chart: ./charts/networkpolicy/common
  version: 0.2.0
  values:
  - values/networkpolicy/common.yaml.gotmpl

- name: networkpolicy
  namespace: monitoring
  labels:
    netpol: monitoring
  installed: {{ .Values.networkPolicies.monitoring.enabled }}
  chart: ./charts/networkpolicy/generator
  version: 0.1.0
  values:
  - values/networkpolicies/common/common.yaml.gotmpl
  - values/networkpolicies/common/prometheus.yaml.gotmpl
  - values/networkpolicies/common/trivy.yaml.gotmpl
  {{- if eq .Environment.Name "service_cluster" }}
  - values/networkpolicies/service/alertmanager.yaml.gotmpl
  - values/networkpolicies/service/grafana.yaml.gotmpl
  {{- else if eq .Environment.Name "workload_cluster" }}
  - values/networkpolicies/workload/alertmanager.yaml.gotmpl
  {{- end }}

{{ if eq .Environment.Name "service_cluster" }}

- name: networkpolicy
  namespace: harbor
  labels:
    netpol: harbor
  installed: {{ .Values.networkPolicies.harbor.enabled }}
  chart: ./charts/networkpolicy/generator
  version: 0.1.0
  values:
  - values/networkpolicies/common/common.yaml.gotmpl
  - values/networkpolicies/service/harbor.yaml.gotmpl

- name: networkpolicy
  namespace: thanos
  labels:
    netpol: thanos
  installed: {{ .Values.networkPolicies.thanos.enabled }}
  chart: ./charts/networkpolicy/generator
  version: 0.1.0
  values:
  - values/networkpolicies/common/common.yaml.gotmpl
  - values/networkpolicies/service/thanos.yaml.gotmpl

- name: service-cluster-np
  namespace: kube-system
  labels:
    netpol: service
  chart: ./charts/networkpolicy/service-cluster
  version: 0.2.0
  values:
  - values/networkpolicy/service-cluster.yaml.gotmpl

{{ end }}

{{ if eq .Environment.Name "workload_cluster" }}

- name: workload-cluster-np
  namespace: kube-system
  labels:
    netpol: workload
  chart: ./charts/networkpolicy/workload-cluster
  version: 0.2.0
  values:
  - values/networkpolicy/workload-cluster.yaml.gotmpl

- name: networkpolicy
  namespace: hnc-system
  labels:
    netpol: hnc
  installed: {{ .Values.hnc.enabled }}
  chart: ./charts/networkpolicy/generator
  version: 0.1.0
  values:
  - values/networkpolicies/common/common.yaml.gotmpl
  - values/networkpolicies/workload/hnc.yaml.gotmpl

{{ end }}

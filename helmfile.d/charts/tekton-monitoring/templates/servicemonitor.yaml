apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: {{ printf "%s-%s" (include "tekton-monitoring.fullname" .) "servicemonitor" | trunc 63 | trimSuffix "-" }}
spec:
  namespaceSelector:
    matchNames:
    - {{ .Release.Namespace  }}
  selector:
    matchLabels:
      app: tekton-pipelines-controller
      app.kubernetes.io/component: controller
      app.kubernetes.io/instance: default
      app.kubernetes.io/name: controller
      app.kubernetes.io/part-of: tekton-pipelines
  endpoints:
  - port: http-metrics
    path: /metrics
    interval: 30s
    honorLabels: true
    metricRelabelings:
      # The exported_namespace label is deprecated for these metrics and will be removed in three minor releases, likely v0.52
    - action: replace
      sourceLabels:
      - namespace
      targetLabel: exported_namespace

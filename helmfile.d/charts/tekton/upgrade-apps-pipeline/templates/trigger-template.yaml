{{- if .Values.tekton.listener.enabled }}
apiVersion: triggers.tekton.dev/v1beta1
kind: TriggerTemplate
metadata:
  name: {{ include "upgrade-apps-pipeline.fullname" . }}-github-template
  annotations:
    triggers.tekton.dev/old-escape-quotes: "true"
spec:
  resourcetemplates:
    - apiVersion: tekton.dev/v1beta1
      kind: PipelineRun
      metadata:
        generateName: {{ include "upgrade-apps-pipeline.fullname" . }}-run-
      spec:
        pipelineRef:
          name: {{ include "upgrade-apps-pipeline.fullname" . }}
        podTemplate:
          securityContext:
            fsGroup: 1000
            runAsUser: 1000
            runAsGroup: 1000
        workspaces:
        - name: shared-data
          volumeClaimTemplate:
            metadata:
              name: {{ include "upgrade-apps-pipeline.fullname" . }}-pvc
            spec:
              {{- if not ( empty .Values.tekton.pipeline.workspace.storageClassName ) }}
              storageClassName: {{ .Values.tekton.pipeline.workspace.storageClassName  }}
              {{- end }}
              accessModes:
                - ReadWriteOnce
              resources:
                requests:
                  storage: {{ .Values.tekton.pipeline.workspace.storageCapacity  }}
        - name: ssh-creds
          secret:
            secretName: ssh-credentials
{{- end }}

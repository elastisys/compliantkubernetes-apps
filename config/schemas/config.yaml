$schema: https://json-schema.org/draft/2020-12/schema
$id: https://github.com/elastisys/compliantkubernetes-apps/raw/main/config/schemas/config.yaml
title: Compliant Kubernetes Apps Config
description: |
  This describes the structure of the config for both the service and workload clusters.

  Keep in mind that this is evaluated on the merged config, and each config file will contain different properties.
$defs:
  component:
    deprecated: true
    additionalProperties: false
    description: This is meant to describe the base class if you will, for ck8s resources.
    properties:
      affinity:
        $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      enabled:
        type: boolean
      nodeSelector:
        $ref: '#/$defs/kubernetesNodeSelector'
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
      tolerations:
        $ref: '#/$defs/kubernetesTolerations'
      topologySpreadConstraints:
        $ref: '#/$defs/kubernetesTopologySpreadConstraints'
    required: [] # Shouldn't at least 'enabled' be required?
    title: Common Resource
    type: object
  cpumem:
    deprecated: true
    description: |-
      Use `.$defs.kubernetesQuantity` instead.
    additionalProperties: false
    properties:
      cpu:
        default: 100m
        pattern: ^[1-9][0-9]*m?$
        type:
          - string
          - integer
      memory:
        default: 128Mi
        pattern: ^[0-9]+(\.[0-9]+)?([KMG]i)?$
        type:
          - string
          - integer
    title: CPU and Memory Specifications
    type: object
  extraArgs:
    items:
      type: string
    title: Extra Arguments
    description: |-
      Extra arguments passed to a container
    type: array
  fluentdBuffer:
    title: Fluentd Buffer Config
    description: |-
      Fluentd buffer configuration parameters.

      > [!note]
      > See [upstream documentation for reference](https://docs.fluentd.org/configuration/buffer-section#parameters), set keys will be converted from `camelCase` to `snake_case`.
    additionalProperties:
      title: Additional Properties
      description: |-
        Additional properties
      $comment: Assuming that these are never structures, only scalars
      not:
        title: Invalid Additional Properties Types
        description: |-
          Invalid additional properties types
        type:
          - object
          - array
      type:
        - string
        - integer
        - boolean
    type: object
    properties:
      timekey:
        title: Time Key
        description: |-
          Output plugin will flush chunks per specified time (enabled when time is specified in chunk keys).

          [Common/Time  parameters](https://docs.fluentd.org/configuration/buffer-section#argument)
        examples:
          - 10m
        type: string
      timekeyUseUtc:
        title: Timekey Use UTC
        description: |-
          Output plugin decides to use UTC or not to format placeholders using timekey.

          [Common/Time  parameters](https://docs.fluentd.org/configuration/buffer-section#argument)
        type: boolean
      timekeyWait:
        title: Timekey wait
        description: |-
          Output plugin will write chunks after timekey_wait seconds later after timekey expiration.

          If a user configures timekey 60m, output plugin will wait delayed events for flushed timekey and write the chunk at 10 minutes of each hour.

          [Common/Time  parameters](https://docs.fluentd.org/configuration/buffer-section#argument)
        examples:
          - 1m
        type: string
      chunkLimitSize:
        title: Chunk Limit Size
        description: |-
          Events will be written into chunks until the size of chunks become `chunkLimitSize`.

          [Buffering parameters](https://docs.fluentd.org/configuration/buffer-section#buffering-parameters)
        examples:
          - 50MB
        type: string
      totalLimitSize:
        title: Total Limit Size
        description: |-
          The size limitation of this buffer plugin instance.

          Once the total size of stored buffer reached this threshold, all append operations will fail with error (and data will be lost).

          [Buffering parameters](https://docs.fluentd.org/configuration/buffer-section#buffering-parameters)
        examples:
          - 9GB
        type: string
      flushInterval:
        title: Flush Interval
        description: |-
          Flushes the buffer each `flushInterval`, if `flushMode` is equal to `interval`.

          [Flushing parameters](https://docs.fluentd.org/configuration/buffer-section#flushing-parameters)
        examples:
          - 15m
        type: string
      flushMode:
        title: Flush Mode
        description: |-
          The flush mode to use.

          [Flushing parameters](https://docs.fluentd.org/configuration/buffer-section#flushing-parameters)
        enum:
          - lazy
          - interval
          - immediate
        meta:enum:
          lazy: Flushes/writes chunks once per timekey
          interval: Flushes/writes chunks per specified time via flushInterval
          immediate: Flushes/writes chunks immediately after events are appended into chunks
        type: string
      flushThreadBurstInterval:
        title: Flush Thread Burst Interval
        description: |-
          The sleep interval (seconds) for threads between flushes when the output plugin flushes the waiting chunks to the next ones.

          [Flushing parameters](https://docs.fluentd.org/configuration/buffer-section#flushing-parameters)
        type: number
      flushThreadCount:
        title: Flush Thread Count
        description: |-
          The number of threads to flush/write chunks in parallel.

          [Flushing parameters](https://docs.fluentd.org/configuration/buffer-section#flushing-parameters)
        type: integer
      retryForever:
        title: Retry Forever
        description: |-
          If true, plugin will ignore `retryTimeout` and `retryMaxTimes` options and retry flushing forever.

          [Retries parameters](https://docs.fluentd.org/configuration/buffer-section#retries-parameters)
        type: boolean
      retryType:
        title: Retry Type
        description: |-
          The retry algorithm type to use.

          [Retries parameters](https://docs.fluentd.org/configuration/buffer-section#retries-parameters)
        enum:
          - exponential_backoff
          - periodic
        meta:enum:
          exponential_backoff: Increase the wait time, in seconds, exponentially per failure
          periodic: Output plugin will retry periodically with fixed intervals (configured via retryWait)
        type: string
      retryMaxInterval:
        title: Retry Max Interval
        description: |-
          The maximum interval (seconds) for exponential backoff between retries while failing.

          [Retries parameters](https://docs.fluentd.org/configuration/buffer-section#retries-parameters)
        type: integer
  goDuration:
    title: Duration String
    description: |-
      A duration string is a possibly signed sequence of decimal numbers, each with optional fraction and a unit suffix, such as "300ms", "-1.5h" or "2h45m".

      Valid time units are "ns", "us" (or "µs"), "ms", "s", "m", "h".
    examples:
      - 2h45m0s
    pattern: ^([-+]?[0-9]+(.[0-9]+)?(ns|us|µs|ms|s|m|h))+$
    type: string
  iplist:
    title: List Of IP Netmasks
    description: |-
      List of IP netmasks
    items:
      type: string
      regex: ^[0-9a-f.:]{2,45}/[0-9]{1,3}$
      description: A IP address with netmask
      examples:
        - 0.0.0.0/0
        - 192.0.2.1/24
        - 2001:db8:0:1234::/64
    type: array
  netpolRule:
    title: IP And Port List
    description: |-
      Network policy rule

      [Kubernetes network policies](https://kubernetes.io/docs/concepts/services-networking/network-policies/)
    additionalProperties: false
    properties:
      ips:
        $ref: '#/$defs/iplist'
      ports:
        $ref: '#/$defs/portlist'
    type: object
  kubernetesNodeSelector:
    title: Kubernetes Node Selector
    description: |-
      Kubernetes node selector

      [Kubernetes assign pod node](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector)
    additionalProperties:
      type: string
    examples:
      - kubernetes.io/os: linux
    type: object
  percentage:
    description: Percentage, 0% - 100%
    maximum: 100
    minimum: 0
    title: Percentage
    type: number
  portlist:
    title: Port Number List
    description: |-
      A 16 bit unsigned integer
    items:
      maximum: 65535
      minimum: 1
      type: integer
    type: array
  kubernetesResourceRequirements:
    title: Kubernetes Resource Requirements
    description: |-
      Resource requests are used by the kube-scheduler to pick a node to schedule pods on.

      Limits are enforced. Resources are commonly 'cpu' and 'memory'.
    additionalProperties: false
    properties:
      requests:
        $ref: '#/$defs/kubernetesQuantityMap'
      limits:
        $ref: '#/$defs/kubernetesQuantityMap'
    type: object
    examples:
      - requests:
          memory: 128Mi
          cpu: 100m
        limits:
          memory: 256Mi
          cpu: 250m
  timeRange:
    title: Time Range
    description: |-
      An amount of time
    examples:
      - 300s
      - 72h
      - 3d
    pattern: ^[0-9]+[hmsd]+$
    type: string
  kubernetesTolerations:
    title: Kubernetes Tolerations
    description: |-
      Kubernetes Tolerations

      [Kubernetes taint and toleration](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/)
    items:
      allOf:
        - $ref: '#/$defs/io.k8s.api.core.v1.Toleration'
      default: {}
    type: array
  kubernetesTopologySpreadConstraints:
    title: Kubernetes Topology Spread Constraints
    description: |-
      TopologySpreadConstraints describes how pods should spread across topology domains.
    items:
      allOf:
        - $ref: '#/$defs/io.k8s.api.core.v1.TopologySpreadConstraint'
      default: {}
    type: array
  kubernetesQuantityMap:
    title: Kubernetes Quantity Map
    description: ""
    type: object
    additionalProperties:
      $ref: '#/$defs/kubernetesQuantity'
  kubernetesQuantity:
    title: Kubernetes Quantity
    type:
      - string
      - number
    regex: ^[-+]?[0-9]+([KMGTPE]i|[eE][0-9]+|[mkMGTPE])?$
    description: |-
      Used for CPU shares, memory and storage size etc.

      See <https://github.com/kubernetes/apimachinery/blob/master/pkg/api/resource/quantity.go>
  kubernetesPersistentVolumeClaim:
    title: Kubernetes Persistent Volume Claim
    description: |-
      PersistentVolumeClaim
    additionalProperties: false
    properties:
      size:
        default: 1Gi
        type: string
    type: object
  io.k8s.api.core.v1.Affinity:
    title: Affinity
    description: |-
      Affinity is a group of affinity scheduling rules.
    properties:
      nodeAffinity:
        allOf:
          - $ref: '#/$defs/io.k8s.api.core.v1.NodeAffinity'
        description: Describes node affinity scheduling rules for the pod.
      podAffinity:
        allOf:
          - $ref: '#/$defs/io.k8s.api.core.v1.PodAffinity'
        description: Describes pod affinity scheduling rules (e.g. co-locate this pod in the same node, zone, etc. as some other pod(s)).
      podAntiAffinity:
        allOf:
          - $ref: '#/$defs/io.k8s.api.core.v1.PodAntiAffinity'
        description: Describes pod anti-affinity scheduling rules (e.g. avoid putting this pod in the same node, zone, etc. as some other pod(s)).
    type: object
  io.k8s.apimachinery.pkg.apis.meta.v1.LabelSelectorRequirement:
    title: Label Selector Requirement
    description: |-
      A label selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
    properties:
      key:
        default: ""
        description: key is the label key that the selector applies to.
        type: string
      operator:
        default: ""
        description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
        type: string
      values:
        title: Values
        description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
        items:
          default: ""
          type: string
        type: array
        x-kubernetes-list-type: atomic
    required:
      - key
      - operator
    type: object
  io.k8s.api.core.v1.NodeAffinity:
    title: NodeAffinity
    description: |-
      Node affinity is a group of node affinity scheduling rules.
    properties:
      preferredDuringSchedulingIgnoredDuringExecution:
        title: Preferred During Scheduling Ignored During Execution
        description: The scheduler will prefer to schedule pods to nodes that satisfy the affinity expressions specified by this field, but it may choose a node that violates one or more of the expressions. The node that is most preferred is the one with the greatest sum of weights, i.e. for each node that meets all of the scheduling requirements (resource request, requiredDuringScheduling affinity expressions, etc.), compute a sum by iterating through the elements of this field and adding "weight" to the sum if the node matches the corresponding matchExpressions; the node(s) with the highest sum are the most preferred.
        items:
          allOf:
            - $ref: '#/$defs/io.k8s.api.core.v1.PreferredSchedulingTerm'
          default: {}
        type: array
        x-kubernetes-list-type: atomic
      requiredDuringSchedulingIgnoredDuringExecution:
        allOf:
          - $ref: '#/$defs/io.k8s.api.core.v1.NodeSelector'
        description: If the affinity requirements specified by this field are not met at scheduling time, the pod will not be scheduled onto the node. If the affinity requirements specified by this field cease to be met at some point during pod execution (e.g. due to an update), the system may or may not try to eventually evict the pod from its node.
    type: object
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.PodAffinity:
    title: PodAffinity
    description: |-
      Pod affinity is a group of inter pod affinity scheduling rules.
    properties:
      preferredDuringSchedulingIgnoredDuringExecution:
        title: Preferred During Scheduling Ignored During Execution
        description: The scheduler will prefer to schedule pods to nodes that satisfy the affinity expressions specified by this field, but it may choose a node that violates one or more of the expressions. The node that is most preferred is the one with the greatest sum of weights, i.e. for each node that meets all of the scheduling requirements (resource request, requiredDuringScheduling affinity expressions, etc.), compute a sum by iterating through the elements of this field and adding "weight" to the sum if the node has pods which matches the corresponding podAffinityTerm; the node(s) with the highest sum are the most preferred.
        items:
          allOf:
            - $ref: '#/$defs/io.k8s.api.core.v1.WeightedPodAffinityTerm'
          default: {}
        type: array
        x-kubernetes-list-type: atomic
      requiredDuringSchedulingIgnoredDuringExecution:
        title: Required During Scheduling Ignored During Execution
        description: If the affinity requirements specified by this field are not met at scheduling time, the pod will not be scheduled onto the node. If the affinity requirements specified by this field cease to be met at some point during pod execution (e.g. due to a pod label update), the system may or may not try to eventually evict the pod from its node. When there are multiple elements, the lists of nodes corresponding to each podAffinityTerm are intersected, i.e. all terms must be satisfied.
        items:
          allOf:
            - $ref: '#/$defs/io.k8s.api.core.v1.PodAffinityTerm'
          default: {}
        type: array
        x-kubernetes-list-type: atomic
    type: object
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.PodAntiAffinity:
    title: PodAntiAffinity
    description: |-
      Pod anti affinity is a group of inter pod anti affinity scheduling rules.
    properties:
      preferredDuringSchedulingIgnoredDuringExecution:
        title: Preferred During Scheduling Ignored During Execution
        description: The scheduler will prefer to schedule pods to nodes that satisfy the anti-affinity expressions specified by this field, but it may choose a node that violates one or more of the expressions. The node that is most preferred is the one with the greatest sum of weights, i.e. for each node that meets all of the scheduling requirements (resource request, requiredDuringScheduling anti-affinity expressions, etc.), compute a sum by iterating through the elements of this field and adding "weight" to the sum if the node has pods which matches the corresponding podAffinityTerm; the node(s) with the highest sum are the most preferred.
        items:
          allOf:
            - $ref: '#/$defs/io.k8s.api.core.v1.WeightedPodAffinityTerm'
          default: {}
        type: array
        x-kubernetes-list-type: atomic
      requiredDuringSchedulingIgnoredDuringExecution:
        title: Required During Scheduling Ignored During Execution
        description: If the anti-affinity requirements specified by this field are not met at scheduling time, the pod will not be scheduled onto the node. If the anti-affinity requirements specified by this field cease to be met at some point during pod execution (e.g. due to a pod label update), the system may or may not try to eventually evict the pod from its node. When there are multiple elements, the lists of nodes corresponding to each podAffinityTerm are intersected, i.e. all terms must be satisfied.
        items:
          allOf:
            - $ref: '#/$defs/io.k8s.api.core.v1.PodAffinityTerm'
          default: {}
        type: array
        x-kubernetes-list-type: atomic
    type: object
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.PreferredSchedulingTerm:
    title: PreferredSchedulingTerm
    description: |-
      An empty preferred scheduling term matches all objects with implicit weight 0 (i.e. it's a no-op). A null preferred scheduling term matches no objects (i.e. is also a no-op).
    properties:
      preference:
        allOf:
          - $ref: '#/$defs/io.k8s.api.core.v1.NodeSelectorTerm'
        default: {}
        description: A node selector term, associated with the corresponding weight.
      weight:
        default: 0
        description: Weight associated with matching the corresponding nodeSelectorTerm, in the range 1-100.
        format: int32
        type: integer
    required:
      - weight
      - preference
    type: object
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.NodeSelector:
    title: NodeSelector
    description: |-
      A node selector represents the union of the results of one or more label queries over a set of nodes; that is, it represents the OR of the selectors represented by the node selector terms.
    properties:
      nodeSelectorTerms:
        title: Node Selector Terms
        description: Required. A list of node selector terms. The terms are ORed.
        items:
          allOf:
            - $ref: '#/$defs/io.k8s.api.core.v1.NodeSelectorTerm'
          default: {}
        type: array
        x-kubernetes-list-type: atomic
    required:
      - nodeSelectorTerms
    type: object
    x-kubernetes-map-type: atomic
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.WeightedPodAffinityTerm:
    title: WeightedPodAffinityTerm
    description: |-
      The weights of all of the matched WeightedPodAffinityTerm fields are added per-node to find the most preferred node(s)
    properties:
      podAffinityTerm:
        allOf:
          - $ref: '#/$defs/io.k8s.api.core.v1.PodAffinityTerm'
        default: {}
        description: Required. A pod affinity term, associated with the corresponding weight.
      weight:
        default: 0
        description: weight associated with matching the corresponding podAffinityTerm, in the range 1-100.
        format: int32
        type: integer
    required:
      - weight
      - podAffinityTerm
    type: object
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.PodAffinityTerm:
    title: PodAffinityTerm
    description: |-
      Defines a set of pods (namely those matching the labelSelector relative to the given namespace(s)) that this pod should be co-located (affinity) or not co-located (anti-affinity) with, where co-located is defined as running on a node whose value of the label with key <topologyKey> matches that of any node on which a pod of the set of pods is running
    properties:
      labelSelector:
        allOf:
          - $ref: '#/$defs/io.k8s.apimachinery.pkg.apis.meta.v1.LabelSelector'
        description: A label query over a set of resources, in this case pods. If it's null, this PodAffinityTerm matches with no Pods.
      matchLabelKeys:
        title: Match Label Keys
        description: MatchLabelKeys is a set of pod label keys to select which pods will be taken into consideration. The keys are used to lookup values from the incoming pod labels, those key-value labels are merged with `labelSelector` as `key in (value)` to select the group of existing pods which pods will be taken into consideration for the incoming pod's pod (anti) affinity. Keys that don't exist in the incoming pod labels will be ignored. The default value is empty. The same key is forbidden to exist in both matchLabelKeys and labelSelector. Also, matchLabelKeys cannot be set when labelSelector isn't set. This is an alpha field and requires enabling MatchLabelKeysInPodAffinity feature gate.
        items:
          default: ""
          type: string
        type: array
        x-kubernetes-list-type: atomic
      mismatchLabelKeys:
        title: Mismatch Label Keys
        description: MismatchLabelKeys is a set of pod label keys to select which pods will be taken into consideration. The keys are used to lookup values from the incoming pod labels, those key-value labels are merged with `labelSelector` as `key notin (value)` to select the group of existing pods which pods will be taken into consideration for the incoming pod's pod (anti) affinity. Keys that don't exist in the incoming pod labels will be ignored. The default value is empty. The same key is forbidden to exist in both mismatchLabelKeys and labelSelector. Also, mismatchLabelKeys cannot be set when labelSelector isn't set. This is an alpha field and requires enabling MatchLabelKeysInPodAffinity feature gate.
        items:
          default: ""
          type: string
        type: array
        x-kubernetes-list-type: atomic
      namespaceSelector:
        allOf:
          - $ref: '#/$defs/io.k8s.apimachinery.pkg.apis.meta.v1.LabelSelector'
        description: A label query over the set of namespaces that the term applies to. The term is applied to the union of the namespaces selected by this field and the ones listed in the namespaces field. null selector and null or empty namespaces list means "this pod's namespace". An empty selector ({}) matches all namespaces.
      namespaces:
        title: Namespaces
        description: namespaces specifies a static list of namespace names that the term applies to. The term is applied to the union of the namespaces listed in this field and the ones selected by namespaceSelector. null or empty namespaces list and null namespaceSelector means "this pod's namespace".
        items:
          default: ""
          type: string
        type: array
        x-kubernetes-list-type: atomic
      topologyKey:
        default: ""
        description: This pod should be co-located (affinity) or not co-located (anti-affinity) with the pods matching the labelSelector in the specified namespaces, where co-located is defined as running on a node whose value of the label with key topologyKey matches that of any node on which any of the selected pods is running. Empty topologyKey is not allowed.
        type: string
    required:
      - topologyKey
    type: object
    $comment: Imported from Kubernetes project
  io.k8s.apimachinery.pkg.apis.meta.v1.LabelSelector:
    title: LabelSelector
    description: |-
      A label selector is a label query over a set of resources. The result of matchLabels and matchExpressions are ANDed. An empty label selector matches all objects. A null label selector matches no objects.
    properties:
      matchExpressions:
        title: Match Expressions
        description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
        items:
          allOf:
            - $ref: '#/$defs/io.k8s.apimachinery.pkg.apis.meta.v1.LabelSelectorRequirement'
          default: {}
        type: array
        x-kubernetes-list-type: atomic
      matchLabels:
        additionalProperties:
          default: ""
          type: string
        description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
        type: object
    type: object
    x-kubernetes-map-type: atomic
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.NodeSelectorTerm:
    title: NodeSelectorTerm
    description: |-
      A null or empty node selector term matches no objects. The requirements of them are ANDed. The TopologySelectorTerm type implements a subset of the NodeSelectorTerm.
    properties:
      matchExpressions:
        title: Match Expressions
        description: A list of node selector requirements by node's labels.
        items:
          allOf:
            - $ref: '#/$defs/io.k8s.api.core.v1.NodeSelectorRequirement'
          default: {}
        type: array
        x-kubernetes-list-type: atomic
      matchFields:
        title: Match Fields
        description: A list of node selector requirements by node's fields.
        items:
          allOf:
            - $ref: '#/$defs/io.k8s.api.core.v1.NodeSelectorRequirement'
          default: {}
        type: array
        x-kubernetes-list-type: atomic
    type: object
    x-kubernetes-map-type: atomic
  io.k8s.api.core.v1.NodeSelectorRequirement:
    title: NodeSelectorRequirement
    description: |-
      A node selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
    properties:
      key:
        default: ""
        description: The label key that the selector applies to.
        type: string
      operator:
        default: ""
        description: Represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists, DoesNotExist. Gt, and Lt.
        type: string
      values:
        title: Values
        description: An array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. If the operator is Gt or Lt, the values array must have a single element, which will be interpreted as an integer. This array is replaced during a strategic merge patch.
        items:
          default: ""
          type: string
        type: array
        x-kubernetes-list-type: atomic
    required:
      - key
      - operator
    type: object
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.EnvVar:
    title: Environment Variable
    description: EnvVar represents an environment variable present in a Container.
    type: object
    properties:
      name:
        title: Environment Variable Name
        description: |-
          Name of the environment variable.

          Must be a C_IDENTIFIER.
        type: string
      value:
        title: Environment Variable Value
        description: |-
          Variable references `$(VAR_NAME)` are expanded using the previously defined environment variables in the container and any service environment variables.
          If a variable cannot be resolved, the reference in the input string will be unchanged.
          Double `$$` are reduced to a single `$`, which allows for escaping the `$(VAR_NAME)` syntax: i.e. `$$(VAR_NAME)` will produce the string literal `$(VAR_NAME)`.
          Escaped references will never be expanded, regardless of whether the variable exists or not.
        type: string
      valueFrom:
        $ref: '#/$defs/io.k8s.api.core.v1.EnvVarSource'
    required:
      - name
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.EnvVarSource:
    title: Environment Variable Source
    description: Environment Variable Source represents a source for the value of an Environment Variable.
    type: object
    properties:
      configMapKeyRef:
        $ref: '#/components/schemas/io.k8s.api.core.v1.ConfigMapKeySelector'
      fieldRef:
        $ref: '#/components/schemas/io.k8s.api.core.v1.ObjectFieldSelector'
      resourceFieldRef:
        $ref: '#/components/schemas/io.k8s.api.core.v1.ResourceFieldSelector'
      secretKeyRef:
        $ref: '#/components/schemas/io.k8s.api.core.v1.SecretKeySelector'
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.ConfigMapKeySelector:
    title: Config Map Key Selector
    description: Selects a key from a ConfigMap.
    type: object
    properties:
      key:
        title: Config Map Key
        description: The key to select.
        type: string
        default: ""
      name:
        title: Config Map Name
        type: string
        description: |-
          Name of the referent.

          This field is effectively required, but due to backwards compatibility is allowed to be empty.
          Instances of this type with an empty value here are almost certainly wrong.
          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
        default: ""
      optional:
        title: Config Map Optional
        description: Specify whether the ConfigMap or its key must be defined.
        type: boolean
    required:
      - key
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.ObjectFieldSelector:
    title: Object Field Selector
    description: ObjectFieldSelector selects an APIVersioned field of an object.
    properties:
      apiVersion:
        title: API Version
        description: Version of the schema the FieldPath is written in terms of, defaults to `v1`.
        type: string
      fieldPath:
        title: Field Path
        default: ""
        description: Path of the field to select in the specified API version.
        type: string
    required:
      - fieldPath
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.ResourceFieldSelector:
    title: Resource Field Selector
    description: ResourceFieldSelector represents container resources (cpu, memory) and their output format.
    type: object
    properties:
      containerName:
        title: Container Name
        description: Container name, required for volumes, optional for env vars
        type: string
      divisor:
        title: Divisor
        description: Specifies the output format of the exposed resources, defaults to `1`.
        $ref: "#/$defs/KubernetesQuantity"
      resource:
        title: Resource
        description: Required, resource to select.
        type: string
        default: ""
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.SecretKeySelector:
    title: Secret Key Selector
    description: SecretKeySelector selects a key of a Secret.
    type: object
    properties:
      key:
        description: |-
          The key of the secret to select from.
          Must be a valid secret key.
        type: string
        default: ""
      name:
        description: |-
          Name of the referent.
          This field is effectively required, but due to backwards compatibility is allowed to be empty.
          Instances of this type with an empty value here are almost certainly wrong.
          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
        type: string
        default: ""
      optional:
        description: Specify whether the Secret or its key must be defined
        type: boolean
    required:
      - key
    $comment: Imported from Kubernetes project
  io.k8s.api.core.v1.TopologySpreadConstraint:
    title: Topology Spread Constraint
    description: TopologySpreadConstraint specifies how to spread matching pods among the given topology.
    properties:
      labelSelector:
        allOf:
          - $ref: '#/$defs/io.k8s.apimachinery.pkg.apis.meta.v1.LabelSelector'
        description: LabelSelector is used to find matching pods. Pods that match this label selector are counted to determine the number of pods in their corresponding topology domain.
      matchLabelKeys:
        title: Match Label Keys
        description: |-
          MatchLabelKeys is a set of pod label keys to select the pods over which spreading will be calculated. The keys are used to lookup values from the incoming pod labels, those key-value labels are ANDed with labelSelector to select the group of existing pods over which spreading will be calculated for the incoming pod. The same key is forbidden to exist in both MatchLabelKeys and LabelSelector. MatchLabelKeys cannot be set when LabelSelector isn't set. Keys that don't exist in the incoming pod labels will be ignored. A null or empty list means only match against labelSelector.

          This is a beta field and requires the MatchLabelKeysInPodTopologySpread feature gate to be enabled (enabled by default).
        items:
          default: ""
          type: string
        type: array
        x-kubernetes-list-type: atomic
      maxSkew:
        default: 0
        description: 'MaxSkew describes the degree to which pods may be unevenly distributed. When `whenUnsatisfiable=DoNotSchedule`, it is the maximum permitted difference between the number of matching pods in the target topology and the global minimum. The global minimum is the minimum number of matching pods in an eligible domain or zero if the number of eligible domains is less than MinDomains. For example, in a 3-zone cluster, MaxSkew is set to 1, and pods with the same labelSelector spread as 2/2/1: In this case, the global minimum is 1. | zone1 | zone2 | zone3 | |  P P  |  P P  |   P   | - if MaxSkew is 1, incoming pod can only be scheduled to zone3 to become 2/2/2; scheduling it onto zone1(zone2) would make the ActualSkew(3-1) on zone1(zone2) violate MaxSkew(1). - if MaxSkew is 2, incoming pod can be scheduled onto any zone. When `whenUnsatisfiable=ScheduleAnyway`, it is used to give higher precedence to topologies that satisfy it. It''s a required field. Default value is 1 and 0 is not allowed.'
        format: int32
        type: integer
      minDomains:
        description: |-
          MinDomains indicates a minimum number of eligible domains. When the number of eligible domains with matching topology keys is less than minDomains, Pod Topology Spread treats "global minimum" as 0, and then the calculation of Skew is performed. And when the number of eligible domains with matching topology keys equals or greater than minDomains, this value has no effect on scheduling. As a result, when the number of eligible domains is less than minDomains, scheduler won't schedule more than maxSkew Pods to those domains. If value is nil, the constraint behaves as if MinDomains is equal to 1. Valid values are integers greater than 0. When value is not nil, WhenUnsatisfiable must be DoNotSchedule.

          For example, in a 3-zone cluster, MaxSkew is set to 2, MinDomains is set to 5 and pods with the same labelSelector spread as 2/2/2: | zone1 | zone2 | zone3 | |  P P  |  P P  |  P P  | The number of domains is less than 5(MinDomains), so "global minimum" is treated as 0. In this situation, new pod with the same labelSelector cannot be scheduled, because computed skew will be 3(3 - 0) if new Pod is scheduled to any of the three zones, it will violate MaxSkew.
        format: int32
        type: integer
      nodeAffinityPolicy:
        description: |-
          NodeAffinityPolicy indicates how we will treat Pod's nodeAffinity/nodeSelector when calculating pod topology spread skew. Options are: - Honor: only nodes matching nodeAffinity/nodeSelector are included in the calculations. - Ignore: nodeAffinity/nodeSelector are ignored. All nodes are included in the calculations.

          If this value is nil, the behavior is equivalent to the Honor policy. This is a beta-level feature default enabled by the NodeInclusionPolicyInPodTopologySpread feature flag.
        type: string
      nodeTaintsPolicy:
        description: |-
          NodeTaintsPolicy indicates how we will treat node taints when calculating pod topology spread skew. Options are: - Honor: nodes without taints, along with tainted nodes for which the incoming pod has a toleration, are included. - Ignore: node taints are ignored. All nodes are included.

          If this value is nil, the behavior is equivalent to the Ignore policy. This is a beta-level feature default enabled by the NodeInclusionPolicyInPodTopologySpread feature flag.
        type: string
      topologyKey:
        default: ""
        description: TopologyKey is the key of node labels. Nodes that have a label with this key and identical values are considered to be in the same topology. We consider each <key, value> as a "bucket", and try to put balanced number of pods into each bucket. We define a domain as a particular instance of a topology. Also, we define an eligible domain as a domain whose nodes meet the requirements of nodeAffinityPolicy and nodeTaintsPolicy. e.g. If TopologyKey is "kubernetes.io/hostname", each Node is a domain of that topology. And, if TopologyKey is "topology.kubernetes.io/zone", each zone is a domain of that topology. It's a required field.
        type: string
      whenUnsatisfiable:
        default: ""
        description: |-
          WhenUnsatisfiable indicates how to deal with a pod if it doesn't satisfy the spread constraint. - DoNotSchedule (default) tells the scheduler not to schedule it. - ScheduleAnyway tells the scheduler to schedule the pod in any location,
            but giving higher precedence to topologies that would help reduce the
            skew.
          A constraint is considered "Unsatisfiable" for an incoming pod if and only if every possible node assignment for that pod would violate "MaxSkew" on some topology. For example, in a 3-zone cluster, MaxSkew is set to 1, and pods with the same labelSelector spread as 3/1/1: | zone1 | zone2 | zone3 | | P P P |   P   |   P   | If WhenUnsatisfiable is set to DoNotSchedule, incoming pod can only be scheduled to zone2(zone3) to become 3/2/1(3/1/2) as ActualSkew(2-1) on zone2(zone3) satisfies MaxSkew(1). In other words, the cluster can still be imbalanced, but scheduler won't make it *more* imbalanced. It's a required field.
        type: string
    required:
      - maxSkew
      - topologyKey
      - whenUnsatisfiable
    type: object
  io.k8s.api.core.v1.Toleration:
    title: Toleration
    description: The pod this Toleration is attached to tolerates any taint that matches the triple <key,value,effect> using the matching operator <operator>.
    properties:
      effect:
        description: Effect indicates the taint effect to match. Empty means match all taint effects. When specified, allowed values are NoSchedule, PreferNoSchedule and NoExecute.
        type: string
      key:
        description: Key is the taint key that the toleration applies to. Empty means match all taint keys. If the key is empty, operator must be Exists; this combination means to match all values and all keys.
        type: string
      operator:
        description: Operator represents a key's relationship to the value. Valid operators are Exists and Equal. Defaults to Equal. Exists is equivalent to wildcard for value, so that a pod can tolerate all taints of a particular category.
        type: string
      tolerationSeconds:
        description: TolerationSeconds represents the period of time the toleration (which must be of effect NoExecute, otherwise this field is ignored) tolerates the taint. By default, it is not set, which means tolerate the taint forever (do not evict). Zero and negative values will be treated as 0 (evict immediately) by the system.
        format: int64
        type: integer
      value:
        description: Value is the taint value the toleration matches to. If the operator is Exists, the value should be empty, otherwise just a regular string.
        type: string
    type: object
type: object
required:
  - global
properties:
  global:
    title: Global options
    description: Some common options used in various helm charts.
    type: object
    required:
      - ck8sVersion
      - ck8sCloudProvider
      - ck8sEnvironmentName
      - ck8sFlavor
      - baseDomain
      - opsDomain
    properties:
      ck8sVersion:
        title: Compliant Kubernetes Apps version
        description: |-
          Use version number if you are exactly at a release tag.
          Otherwise use full commit hash of current commit.
          `any`, can be used to disable this validation.
        type: string
        examples:
          - v0.42.1
          - any
          - 424442541a567646c232d949bad1af2b5b7cb885
      ck8sCloudProvider:
        type: string
        enum:
          - aws
          - azure
          - baremetal
          - citycloud
          - elastx
          - exoscale
          - none
          - safespring
          - upcloud
      ck8sEnvironmentName:
        title: Environment name
        type: string
        examples:
          - my-ck8s-cluster
      ck8sFlavor:
        type: string
        enum:
          - prod
          - dev
          - air-gapped
      baseDomain:
        title: Base Domain
        description: |-
          Domain intended for ingress usage in the workload cluster
          and to reach application developer facing services such as Grafana, Harbor and OpenSearch Dashboards.
          E.g. with 'prod.domain.com', OpenSearch Dashboards is reached via 'opensearch.prod.domain.com'.
        type: string
        format: hostname
      opsDomain:
        description: |-
          Domain intended for ingress usage in the service cluster and to reach
          non-user facing services such as Thanos and OpenSearch.
          E.g. with 'ops.prod.domain.com', OpenSearch is reached via 'opensearch.ops.prod.domain.com'.
        type: string
        format: hostname
      scDomain:
        description: If baseDomain for wc and sc are not the same, set the domain of the sc cluster.
        type: string
        oneOf: # Templates do not handle missing values so they must be empty strings to disable. Future FIXME?
          - const: ""
          - format: hostname
      scOpsDomain:
        description: If opsDomain for wc and sc are not the same, set the ops domain of the sc cluster.
        type: string
        oneOf:
          - const: ""
          - format: hostname
      issuer:
        description: |-
          Default cert-manager issuer to use for issuing certificates for ingresses.
          Normally one of `letsencrypt-staging` or `letsencrypt-prod`.
        type: string
        default: letsencrypt-staging
        enum:
          - letsencrypt-staging
          - letsencrypt-prod
      verifyTls:
        description: Verify ingress certificates
        type: boolean
        default: true
      clusterDns:
        description: IP of the cluster DNS in kubernetes
        type: string
        default: 10.233.0.3
        format: ip-address
      clusterName:
        type: string
      clustersMonitoring:
        description: |-
          Names of the workload clusters that sends metrics to this cluster.
          Mainly used for filtering of metrics.
        type: array
        items:
          type: string
          pattern: -[sw]c$
      containerRuntime:
        title: Container runtime
        default: containerd
        type: string
        enum:
          - containerd
          - docker
    additionalProperties: false
  clusterApi:
    additionalProperties: false
    title: ClusterAPI Config
    description: |-
      Set to true if kubernetes is installed with cluster-api.
    type: object
    properties:
      clusters:
        title: "Clusters"
        description: |-
          List of clusters to monitor.

          Used when monitoring clusters for autoscaling.
        items:
          type: string
        type: array
      enabled:
        title: ClusterAPI Enabled
        default: false
        type: boolean
      monitoring:
        title: ClusterAPI Monitoring
        description: |-
          Enable autoscaling monitoring of cluster API clusters.
        additionalProperties: false
        properties:
          enabled:
            title: ClusterAPI Autoscaling Monitoring Enabled
            default: false
            type: boolean
        type: object
  user:
    additionalProperties: false
    title: User Config
    description: |-
      Configuration for Application Developers (users), that use the workload cluster
    type: object
    properties:
      adminGroups:
        title: Admin Groups
        description: |-
          List of groups that Application Developers are apart of that should have access to the cluster.
        items:
          examples:
            - admins
          type: string
        type: array
      adminUsers:
        title: Admin Users
        description: |-
          List of Application Developers that should have access to the cluster.
        items:
          examples:
            - admin@example.com
          type: string
        type: array
      constraints:
        title: Constraints
        description: |-
          Any namespace listed in constraints are exempted from HNC managed namespaces.

          This to override the Pod Security Admission level.

          Example of constraint can be found here: [`Example Constraint`](https://github.com/elastisys/compliantkubernetes-apps/blob/main/helmfile.d/charts/gatekeeper/podsecuritypolicies/values.yaml)

          The only extra label `psaLevel: <baseline/privileged>`` is shown in the following example:

          ```
          <namespace>:
            psaLevel: <baseline/privileged>
            <service-name>:
              ...
          ```
        additionalProperties:
          title: AdditionalProperties
          description: |-
            Additional properties for user.
          additionalProperties:
            title: AdditionalProperties
            description: |-
              Additional properties for user.
            properties: {}
            type: object
          properties: {}
          propertyNames:
            title: Service name
            type: string
          type: object
        properties: {}
        propertyNames:
          title: Namespace
          type: string
        type: object
      createNamespaces:
        title: Enable Create Namespaces
        description: |-
          This only controls if the namespaces should be created, user RBAC is always created.
        type: boolean
      namespaces:
        title: Namespaces
        description: |-
          List of namespaces that should be created for Application Developer.

          It is common to create one namespace for the Application Developer and then create namespaces via HNC.

          Requires that `user.createNamespaces` is enabled.
        items:
          examples:
            - production
            - staging
          type: string
        type: array
      serviceAccounts:
        title: ServiceAccounts
        description: |-
          List of serviceAccounts to create RBAC rules for, used for dev situations.

          [Application developer kube-config for contributors](https://github.com/elastisys/compliantkubernetes-apps/blob/main/docs/application-developer-dev-kubeconifg.md)
        items:
          type: string
        type: array
      alertmanager:
        title: Alertmanager Config
        description: |-
          Configuration for application developer controlled alertmanager.
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          enabled:
            title: Enable User Alertmanager
            type: boolean
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
          topologySpreadConstraints:
            $ref: '#/$defs/kubernetesTopologySpreadConstraints'
          ingress:
            title: Ingress for Alertmanager
            description: |-
              Ingress configuration for user alertmanager.

              Creates basic-auth protected ingress to alertmanager.
            type: object
            properties:
              enabled:
                title: Enable User Alertmanager Ingress
                type: boolean
          image:
            title: Alermanager Image Override Config
            description: |-
              Override the alertmanager container image.
            type: string
            examples:
              - quay.io/prometheus/alertmanager:vX.Y.Z
        type: object
      sealedSecrets:
        title: SealedSecrets
        description: |-
          Installs required cluster resources needed to install sealedSecrets.

          Requires that `gatekeeper.allowUserCRDs.enabled` is enabled.
        type: object
        properties:
          enabled:
            title: Enable SealedSecrets
            type: boolean
        additionalProperties: false
      mongodb:
        title: MongoDB
        description: |-
          Installs required cluster resources needed to install MongoDB.

          Requires that `gatekeeper.allowUserCRDs.enabled` is enabled.
        type: object
        properties:
          enabled:
            title: Enable MongoDB
            type: boolean
        additionalProperties: false
      fluxv2:
        title: Fluxv2
        description: |-
          Installs required cluster resources needed to install fluxv2.

          Requires that `gatekeeper.allowUserCRDs.enabled` is enabled.
        type: object
        properties:
          enabled:
            title: Enable Fluxv2
            type: boolean
        additionalProperties: false
      kafka:
        title: Kafka
        description: |-
          Installs required cluster resources needed to install kafka-operator.

          Requires that `gatekeeper.allowUserCRDs.enabled` is enabled.
        type: object
        properties:
          enabled:
            title: Enable Kafka
            type: boolean
        additionalProperties: false
  hnc:
    additionalProperties: false
    title: HNC (Hierarchical Namespace Controller) Config
    description: |-
      Configuration for Hierarchical Namespace Controller.

      > [!note]
      > See [upstream documentation for reference](https://github.com/kubernetes-sigs/hierarchical-namespaces/blob/master/docs/user-guide/README.md).
    type: object
    properties:
      enabled:
        title: Enable HNC
        description: |-
          Enable HNC
        type: boolean
        default: true
      additionalAllowPropagateResources:
        title: Additional Allow Propagate Resources List
        description: |-
          Additional resources to enable opt-in propagation for.
          Objects that should be propagated must have one of the annotations listed here https://github.com/kubernetes-sigs/hierarchical-namespaces/blob/master/docs/user-guide/how-to.md#limit-the-propagation-of-an-object-to-descendant-namespaces
        items:
          title: Additional Allow Propagate Resources
          description: |-
            Additional allow propagate resources for hnc.
          additionalProperties: false
          properties:
            group:
              examples:
                - networking.k8s.io
              type: string
            resource:
              examples:
                - networkpolicies
                - secrets
              type: string
          type: object
        examples:
          - resource: secrets
          - resource: networkpolicies
            group: networking.k8s.io
        type: array
      excludedExtraNamespaces:
        title: Excluded Extra Namespaces
        description: |-
          Extra excluded namespace, here we should add the namespaces that are more likely to change

          [Including and excluding namespaces](https://github.com/kubernetes-sigs/hierarchical-namespaces/blob/master/docs/user-guide/how-to.md#including-and-excluding-namespaces-from-hnc)
        items:
          type: string
        type: array
      excludedNamespaces:
        title: Excluded Namespaces
        description: |-
          Excluded namespaces
        items:
          examples:
            - alertmanager
            - cert-manager
            - falco
            - fluentd
            - fluentd-system
            - gatekeeper-system
            - hnc-system
            - ingress-nginx
            - kube-node-lease
            - kube-public
            - kube-system
            - kured
            - metallb-system
            - monitoring
            - rook-ceph
            - velero
          type: string
        type: array
      ha:
        title: Enable Ha (High Availability)
        description: |-
          Enable HA mode for hnc webhooks.
        type: boolean
        default: true
      includedNamespacesRegex:
        title: Included Namespaces Regex
        description: |-
          Included namespaces, empty string will include all.

          [Including and excluding namespaces](https://github.com/kubernetes-sigs/hierarchical-namespaces/blob/master/docs/user-guide/how-to.md#including-and-excluding-namespaces-from-hnc)
        type: string
      managedNamespaceAnnotations:
        title: Managed Namespace Annotations
        description: |-
          Annotations that will be propagated to subnamespaces (allows regex).
        items:
          type: string
        type: array
      managedNamespaceLabels:
        title: Managed Namespace Labels
        description: |-
          Labels that will be propagated to subnamespaces (allows regex).

          Labels in particular must also be configured in the HierarchyConfiguration object to be propagated.
        items:
          examples:
            - pod-security.kubernetes.io/audit
            - pod-security.kubernetes.io/enforce
            - pod-security.kubernetes.io/warn
          type: string
        type: array
      manager:
        title: Manager Config
        description: |-
          Configuration for Manager.
        $ref: '#/$defs/component'
      serviceMonitor:
        title: Service Monitor
        description: |
          Service monitor for Hierarchical Namespace Controller.
        additionalProperties: false
        properties:
          relabelings:
            title: Relabelings
            description: |-
              Relabeling
            items: {}
            type: array
        type: object
      unpropagatedAnnotations:
        title: Unpropagated Annotations
        description: |-
          Annotations that will be stripped from propagated objects
        items: {}
        type: array
      webhook:
        title: Webhook Config
        description: |
          Webhook for Hierarchical Namespace Controller.
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          nodeSelector:
            $ref: '#/$defs/io.k8s.api.core.v1.NodeSelector'
          replicaCount:
            type: integer
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
          topologySpreadConstraints:
            $ref: '#/$defs/kubernetesTopologySpreadConstraints'
        type: object
      webhookMatchConditions:
        title: Webhook Match Conditions Enable
        description: |-
          Fine grained mach conditions for webhook.

          This feature is only available in Kubernetes v1.28+.
        type: boolean
  harbor:
    additionalProperties: false
    title: Harbor Config
    description: |-
      Configuration options for Harbor.

      Harbor is a container registry that deployed for the application developers to use when deploying their applications.

      > [!note]
      > See [upstream documentation for reference](https://github.com/goharbor/harbor-helm#configuration).
      > All config variables that exists in harbor are not exposed via our config.
    type: object
    properties:
      enabled:
        title: Enable Harbor
        default: true
        type: boolean
      alerts:
        title: Alert Config
        description: |-
          Configuration options for Harbor Alerts.
        additionalProperties: false
        properties:
          maxTotalArtifacts:
            title: Alert For Max Total Artifacts
            description: |-
              Alert when the total number of artifacts is above the set number.
            default: 1000
            type: number
          maxTotalStorageUsedGB:
            title: Alert For Max Total Storage Used (GB)
            description: |-
              Alert when the total storage usage is above the set number.
            default: 500
            type: number
        type: object
      backup:
        title: Backup Job Config
        description: |-
          Configuration options for Backup Job.
        additionalProperties: false
        properties:
          enabled:
            title: Enable Harbor Backup
            default: true
            type: boolean
          ephemeralBackupStore:
            title: Ephemeral Backup Store Config
            description: |-
              EphemeralBackupStore configuration for Harbor

              `StorageSize` defines how large the ephemeral volumes will be.
            properties:
              enabled:
                title: Enable Ephemeral Backup Store
                type: boolean
              storageSize:
                title: Storage Size
                type: string
                default: 10Gi
            type: object
          retentionDays:
            title: Backup Retention Days
            description: |-
              `RetentionDays` defines how old a backup should be before deleting it.
            default: 7
            type: number
        type: object
      core:
        title: Core Config
        description: |-
          Configuration options for Core.
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          replicas:
            title: Core replication
            description: |-
              Number of Core pods
            default: 1
            type: number
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
        type: object
      database:
        title: Database Config
        description: |-
          Configuration options for Database used by Harbor

          Set `type` to define which type of redis Harbor should use.

          Only `external` or `internal` database can be enabled at the same time.

          `External`: Defines an external postgres that harbor will use.
          For more details how to configure harbor to use an external database check the [README](https://github.com/elastisys/compliantkubernetes-apps?tab=readme-ov-file#harbor-ha---work-in-progress)

          `Internal`: Use the internal database that is packaged with harbor.
        additionalProperties: false
        properties:
          external:
            title: External Database Config
            description: |-
              Configuration options for External Database.
            additionalProperties: false
            properties:
              coreDatabase:
                title: Core Database
                description: |-
                  Name of the database for Core
                default: registry
                type: string
              notaryServerDatabase:
                title: Notary Server Database
                description: |-
                  Name of the database for Notary Server
                default: notaryserver
                type: string
              notarySignerDatabase:
                title: Notary Signer Database
                description: |-
                  Name of the database for Notary Signer
                default: notarysigner
                type: string
              port:
                title: Database Port
                description: |-
                  Database listening port
                default: "5432"
                type: string
              sslmode:
                title: SSL mode type
                default: disable
                enum:
                  - disable
                  - require
                  - verify-ca
                  - verify-full
                meta:enum:
                  disable: No SSL
                  require: Skip verification
                  verify-ca:  Always SSL (verify that the certificate presented by the server was signed by a trusted CA)
                  verify-full: Always SSL (verify that the certification presented by the server was signed by a trusted CA and the server host name matches the one in the certificate)
                type: string
            type: object
          internal:
            title: Internal Database Config
            description: |-
              Configuration options for Internal Database.
            additionalProperties: false
            properties:
              affinity:
                $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
              persistentVolumeClaim:
                $ref: '#/$defs/kubernetesPersistentVolumeClaim'
              resources:
                $ref: '#/$defs/kubernetesResourceRequirements'
            type: object
          type:
            default: internal
            type: string
        type: object
      gc:
        title: GC (Garbage Collection) Config
        description: |-
          Configuration options for GC (Garbage Collection).
        additionalProperties: false
        properties:
          enabled:
            title: Enable GC (Garbage Collection)
            default: true
            type: boolean
          forceConfigure:
            title: Force Configure
            default: false
            type: boolean
          schedule:
            title: Schedule
            description: |-
              Defines a CRON schedule when the garbage collection job should run.
            default: 0 0 0 * * SUN
            type: string
        type: object
      ingress:
        title: Ingress Config
        description: |-
          Configuration options for Ingress.
        additionalProperties: false
        properties:
          additionalAnnotations:
            title: Additional Annotations
            type: object
          defaultAnnotations:
            title: DefaultAnnotations
            description: |-
              Default annotations for ingress
            additionalProperties: false
            properties:
              nginx.ingress.kubernetes.io/proxy-buffering:
                title: Nginx Config proxy-buffering
                default: off
                type: string
              nginx.ingress.kubernetes.io/proxy-request-buffering:
                title: Nginx Config proxy-request-buffering
                default: off
                type: string
            type: object
        type: object
      jobservice:
        title: Jobservice Config
        description: |-
          Configuration options for Jobservice.
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          jobLog:
            title: JobLog Config
            description: |-
              Job log configuration
            additionalProperties: false
            properties:
              persistentVolumeClaim:
                $ref: '#/$defs/kubernetesPersistentVolumeClaim'
            type: object
          jobLoggers:
            title: JobLoggers Config
            description: |-
              Configuration options for JobLoggers
            items:
              default: file
              type: string
            type: array
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          scanDataExports:
            title: Scan Data Exports Config
            description: |-
              Scan data exports configuration
            additionalProperties: false
            properties:
              persistentVolumeClaim:
                $ref: '#/$defs/kubernetesPersistentVolumeClaim'
            type: object
        type: object
      nodeSelector:
        $ref: '#/$defs/kubernetesNodeSelector'
      notary:
        title: Notary Config
        description: |-
          Configuration options for Notary.
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          replicas:
            default: 1
            type: number
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          subdomain:
            default: notary.harbor
            type: string
        type: object
      notarySigner:
        title: NotarySigner Config
        description: |-
          Configuration options for Notary signer.
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
        type: object
      oidc:
        title: OIDC (OpenID Connector) Config
        description: |-
          Configuration options for OIDC.
        additionalProperties: false
        properties:
          adminGroupName:
            type: string
          groupClaimName:
            default: groups
            type: string
          scope:
            default: openid,email,profile,offline_access,groups
            type: string
        type: object
      persistence:
        title: Persistence Config
        description: |-
          Configuration options for Persistence.
        additionalProperties: false
        properties:
          disableRedirect:
            type: boolean
          type:
            title: Persistence type
            description:
              This should match what is set in global config
            type: string
            enum:
              - filesystem
              - swift
              - objectStorage
            meta:enum:
              filesystem: Persistent volume
              swift: Swift
              objectStorage: S3
        type: object
      portal:
        title: Portal Config
        description: |-
          Configuration options for Portal.
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          replicas:
            default: 1
            type: number
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
        type: object
      redis:
        title: Redis Config
        description: |-
          Configuration options for Redis used by Harbor

          Set `type` to define which type of redis Harbor should use.

          Only `external` or `internal` redis can be enabled at the same time.

          `External`: Defines an external redis that harbor will use.
          For more details how to configure harbor to use an external redis check the [README](https://github.com/elastisys/compliantkubernetes-apps?tab=readme-ov-file#harbor-ha---work-in-progress)

          `Internal`: Use the internal redis that is packaged with harbor.
        additionalProperties: false
        properties:
          external:
            title: External Redis Config
            description: |-
              Configuration options when external Redis is set
            additionalProperties: false
            properties:
              addr:
                examples:
                  - rfs-redis-harbor.redis-system.svc.cluster.local:26379
                type: string
              sentinelMasterSet:
                type: string
            type: object
          internal:
            title: Internal Redis Config
            description: |-
              Configuration options when internal Redis is set
            additionalProperties: false
            properties:
              affinity:
                $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
              persistentVolumeClaim:
                $ref: '#/$defs/kubernetesPersistentVolumeClaim'
              resources:
                $ref: '#/$defs/kubernetesResourceRequirements'
            type: object
          type:
            default: internal
            type: string
        type: object
      registry:
        title: Registry config
        description: |-
          Registry configuration
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          controller:
            title: Controller
            description: |-
              Controller configuration
            additionalProperties: false
            properties:
              resources:
                $ref: '#/$defs/kubernetesResourceRequirements'
            type: object
          persistentVolumeClaim:
            $ref: '#/$defs/kubernetesPersistentVolumeClaim'
          replicas:
            default: 1
            type: number
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
        type: object
      s3:
        title: Storage Driver S3 Config
        description: |-
          Configuration options for S3.

          [Storage Driver S3](https://distribution.github.io/distribution/storage-drivers/s3/)
        additionalProperties: false
        properties:
          multipartcopychunksize:
            title: Multi Part Copy Chunk Size
            description: |-
              Default chunk size for all but the last S3 Multipart Upload part when copying stored objects.
            type:
              - integer
              - string
          multipartcopymaxconcurrency:
            title: Multi Part Copy Max Concurrency
            description: |-
              Max number of concurrent S3 Multipart Upload operations when copying stored objects.
            type:
              - integer
              - string
          multipartcopythresholdsize:
            title: Multi Part Copy Threshold Size
            description: |-
              Default object size above which S3 Multipart Upload will be used when copying stored objects.
            default: "536870912"
            type: string
            $comment: turn into number?
        type: object
      subdomain:
        title: Sub Domain
        default: harbor
        type: string
      tolerations:
        $ref: '#/$defs/kubernetesTolerations'
      trivy:
        title: Trivy Config
        description: |-
          Configuration options for Trivy.
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          persistentVolumeClaim:
            $ref: '#/$defs/kubernetesPersistentVolumeClaim'
          replicas:
            default: 1
            type: number
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
        type: object
      exporter:
        title: Exporter Config
        description: |-
          Configuration options for Exporter.
        additionalProperties: false
        properties:
          external:
            title: External
            description: |-
              External configuration
            additionalProperties: false
            properties:
              coreDatabase:
                title: Core Database
                examples:
                  - registry
                type: string
              port:
                title: Database Port
                examples:
                  - "5432"
                type: string
            type: object
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
        type: object
  storageClasses:
    additionalProperties: false
    title: Storage Classes Config
    description: |-
      Configuration options for using block storage in Compliant Kubernetes
    properties:
      default:
        description: The StorageClass to use for all persistent volumes in Compliant Kubernetes.
        type: string
        default: default
    type: object
  objectStorage:
    additionalProperties: false
    title: Object Storage Config
    description: |-
      Configuration options for using object storage in Compliant Kubernetes

      This is used for:

      - Fluentd audit logs
      - Fluentd service cluster logs
      - Harbor database backups and registry storage
      - OpenSearch workload cluster log snapshots
      - Rclone object storage sync source and restore destination
      - Thanos metrics storage
      - Velero resource backups and volume snapshots

      Harbor, Rclone, and Thanos have additional configuration to use Swift.
    type: object
    properties:
      buckets:
        title: Object Storage Buckets
        description: |-
          Buckets or containers for each respective application to use for application data or backup storage.

          Keys are used as identifiers for buckets or containers, while the values are used as the bucket or container name.

          Additional entries added here will have monitoring enabled.
        type: object
        additionalProperties:
          title: Bucket Name
          description: The bucket or container name.
          type: string
      type:
        title: Object Storage Type
        description: |-
          Object storage type to use.

          In addition to this Harbor, Rclone, and Thanos have additional configuration to use Swift.
        type: string
        enum:
          - azure
          - gcs
          - s3
          - none
      azure:
        additionalProperties: false
        title: Azure Backend Config
        description: Only supports Azure Public Cloud.
        type: object
        properties:
          resourceGroup:
            title: Azure Resource Group
            description: Resource group of the storage account.
            type: string
      s3:
        additionalProperties: false
        title: S3 Backend Config
        description: Supports both AWS and non-AWS implementations.
        type: object
        properties:
          region:
            title: S3 Region
            description: Region to store data.
            type: string
          regionEndpoint:
            title: S3 Region Endpoint
            description: |-
              Endpoint to reach the S3 service, mainly applicable for non-AWS implementations.

              Make sure to prepend the protocol (e.g. `https://`).
            type: string
            format: uri
          forcePathStyle:
            title: S3 Force Path Style
            description: |-
              Force the use of path style access instead of virtual host style access.

              Generally `false` when using AWS, Exoscale, and UpCloud and `true` for other providers.
            type: boolean
      swift:
        additionalProperties: false
        title: Swift Backend Config
        description: |-
          > [!note]
          > Supported as an option only for Harbor, Rclone, and Thanos.
        type: object
        properties:
          authVersion:
            title: OpenStack Authentication Version
            description: |-
              OpenStack authentication version.

              Set `0` for auto detect from authentication url.
            type: integer
            default: 0
          authUrl:
            title: OpenStack Authentication URL
            description: |-
              OpenStack authentication URL.

              Make sure to prepend the protocol (e.g. `https://`) and append the authentication version (e.g. `/v3`).
            type: string
            format: uri
          region:
            title: OpenStack Region
            description: |-
              OpenStack region.
            type: string
          domainId:
            title: OpenStack Domain ID
            description: |-
              The user domain ID to use.

              User domain is required when authenticating with `username`, set either `domainId` or `domainName`.
            type: string
          domainName:
            title: OpenStack Domain Name
            description: |-
              The user domain name to use.

              User domain is required when authenticating with `username`, set either `domainId` or `domainName`.
            type: string
          projectDomainId:
            title: OpenStack Project Domain ID
            description: |-
              The project domain ID to use.

              Project domain is required when authenticating with `projectName`, set either `projectDomainId` or `projectDomainName`.
            type: string
          projectDomainName:
            title: OpenStack Project Domain Name
            description: |-
              The project domain name to use.

              Project domain is required when authenticating with `projectName`, set either `projectDomainId` or `projectDomainName`.
            type: string
          projectId:
            title: OpenStack Project ID
            description: |-
              The project ID to use.

              Project is required when authenticating with `username`, set either `projectId` or `projectName`.
            type: string
          projectName:
            title: OpenStack Project Name
            description: |-
              The project name to use, requires project domain to be set.

              Project is required when authenticating with `username`, set either `projectId` or `projectName`.
            type: string
          segmentsContainerSuffix:
            title: Swift Segments Container Suffix
            description: |-
              The container suffix to use for segment containers.

              These are created to store large objects with SLOs/DLOs, and with s3api middleware for multipart uploads.
            type: string
            default: +segments
      sync:
        additionalProperties: false
        title: Rclone Sync Config
        description: |-
          Sync object storage from the primary site to a secondary site with Rclone.
        type: object
        properties:
          enabled:
            title: Rclone Sync Enable
            type: boolean
            default: false
          dryrun:
            title: Rclone Sync Dryrun
            description: Deploy Rclone with dryrun enabled.
            type: boolean
            default: false
          syncDefaultBuckets:
            title: Rclone Sync Default Buckets
            description: Sync the buckets or containers set under `.objectStorage.buckets`.
            type: boolean
            default: false
          defaultSchedule:
            title: Rclone Sync Default Schedule
            description: Default schedule to run the sync CronJobs.
            type: string
            default: 0 5 * * *
          buckets:
            title: Rclone Sync Buckets
            description: Additional buckets to sync.
            type: array
            default: []
          destinationType:
            title: Rclone Sync Destination Type
            description: |-
              Object storage type to use.
            type: string
            enum:
              - azure
              - gcs
              - s3
              - swift
          azure:
            $ref: '#/properties/objectStorage/properties/azure'
          s3:
            $ref: '#/properties/objectStorage/properties/s3'
          swift:
            $ref: '#/properties/objectStorage/properties/swift'
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          encrypt:
            additionalProperties: false
            title: Rclone Crypt
            description: |-
              Encrypt data when syncing and decrypt data when restoring.
            properties:
              enabled:
                title: Rclone Crypt Enable
                type: boolean
                default: false
              fileNames:
                title: Rclone Crypt Crypt File Names
                description: Encrypt file names when syncing.
                type: boolean
                default: false
              directoryNames:
                title: Rclone Crypt Crypt Directory Names
                description: Encrypt directory names when syncing, requires file names to be encrypted.
                type: boolean
                default: false
            type: object
      restore:
        additionalProperties: false
        title: Rclone Restore Config
        description: |-
          Restore object storage from a secondary site to the primary site with Rclone.

          > [!note]
          > When enabled this will disable Rclone sync to prevent it from modifying the secondary site.
        type: object
        properties:
          enabled:
            title: Rclone Restore Enable
            type: boolean
            default: false
          dryrun:
            title: Rclone Restore Dryrun
            description: Deploy Rclone with dryrun enabled.
            type: boolean
            default: false
          addTargetsFromSync:
            title: Rclone Restore Targets From Sync
            description: |-
              Automatically configure the restore from a secondary site to the primary site.

              Essentially this will configure Rclone restore to do the inverse of Rclone sync.
            type: boolean
            default: false
          targets:
            title: Rclone Restore Targets
            description: Targets to restore
            type: array
            default: []
          timestamp:
            title: Rclone Restore Timestamp
            description: |-
              Perform point-in-time restore if possible.

              This is only supported for S3 sources.
            type: string
            default: ""
          destinations:
            title: Rclone Restore Destinations
            description: |-
              Allows for complete or partial overrides of the destinations of the restore, the main object storage configuration.
            type: object
            properties:
              azure:
                $ref: '#/properties/objectStorage/properties/azure'
              s3:
                $ref: '#/properties/objectStorage/properties/s3'
              swift:
                $ref: '#/properties/objectStorage/properties/swift'
            default: {}
          sources:
            title: Rclone Restore Sources
            description: |-
              Allows for complete or partial overrides of the sources of the restore, the sync object storage configuration.
            type: object
            properties:
              azure:
                $ref: '#/properties/objectStorage/properties/azure'
              s3:
                $ref: '#/properties/objectStorage/properties/s3'
              swift:
                $ref: '#/properties/objectStorage/properties/swift'
            default: {}
          decrypt:
            description: |-
              Allows for complete or partial overrides of the decrypt of the restore, the sync encrypt configuration.
            $ref: '#/properties/objectStorage/properties/sync/properties/encrypt'
            default: {}
  rookCeph:
    additionalProperties: false
    properties:
      gatekeeperPsp:
        additionalProperties: false
        properties:
          enabled:
            default: false
            type: boolean
        type: object
      monitoring:
        additionalProperties: false
        properties:
          enabled:
            default: false
            type: boolean
        type: object
    type: object
  velero:
    additionalProperties: false
    properties:
      enabled:
        default: true
        type: boolean
      uploaderType:
        enum:
          - restic
          - kopia
        type: string
      nodeAgent:
        additionalProperties: false
        properties:
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
        type: object
      nodeSelector:
        $ref: '#/$defs/kubernetesNodeSelector'
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
      retentionPeriod:
        $ref: '#/$defs/goDuration'
        default: 720h0m0s
      schedule:
        default: 0 0 * * *
        type: string
      tolerations:
        $ref: '#/$defs/kubernetesTolerations'
      storagePrefix:
        type: string
        examples:
          - workload-cluster
      excludedNamespaces:
        description: Excluded namespaces
        type: array
        items:
          type: string
      excludedExtraNamespaces:
        description: Extra excluded namespace, here we should add the namespaces that are more likely to change
        type: array
        items:
          type: string
    type: object
  clusterAdmin:
    additionalProperties: false
    properties:
      groups:
        items:
          type: string
        type: array
      users:
        items:
          type: string
        type: array
    type: object
  dex:
    additionalProperties: false
    dependentRequred:
      enableStaticLogin:
        - staticPassword
    properties:
      additionalKubeloginRedirects:
        items:
          examples:
            - http://localhost:8080/redirect
          format: uri
          type: string
        type: array
      affinity:
        $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      enableStaticLogin:
        default: true
        description: enable a static password login
        type: boolean
      expiry:
        additionalProperties: false
        properties:
          deviceRequests:
            $ref: '#/$defs/timeRange'
            default: 5m
          idToken:
            $ref: '#/$defs/timeRange'
            default: 24h
          refreshTokens:
            additionalProperties: false
            properties:
              absoluteLifetime:
                $ref: '#/$defs/timeRange'
                default: 3960h
              reuseInterval:
                $ref: '#/$defs/timeRange'
                default: 3s
              validIfNotUsedFor:
                $ref: '#/$defs/timeRange'
                default: 2160h
            type: object
          signingKeys:
            default: 6h
            type: string
        type: object
      google:
        additionalProperties: false
        if:
          properties:
            groupSupport:
              const: true
        properties:
          SASecretName:
            type: string
          groupSupport:
            default: false
            type: boolean
        then:
          required:
            - SASecretName
        type: object
      nodeSelector:
        $ref: '#/$defs/kubernetesNodeSelector'
      replicaCount:
        default: 2
        type: number
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
      serviceMonitor:
        additionalProperties: false
        properties:
          enabled:
            default: true
            type: boolean
        type: object
      staticPassword:
        default: $2a$10$2b2cU8CPhOTaGrs1HRQuAueS7JTT5ZHsHSzYiFPm1leZck7Mc8T4W
        description: bcrypt hash of a password
        type: string
      subdomain:
        default: dex
        type: string
      tolerations:
        $ref: '#/$defs/kubernetesTolerations'
      topologySpreadConstraints:
        $ref: '#/$defs/kubernetesTopologySpreadConstraints'
    type: object
  externalTrafficPolicy:
    additionalProperties: false
    properties:
      local:
        default: false
        type: boolean
      whitelistRange:
        additionalProperties:
          default: 0.0.0.0/0
          type:
            - string
            - boolean
        description: |-
          CIDR IP ranges that enable various
          `nginx.ingress.kubernetes.io/whitelist-source-range` annotations or a
          boolean `false` to explicitly opt-out of the annotation.
        title: IP range allow-lists
        type: object
    type: object
  falco:
    additionalProperties: false
    title: Falco Config
    description: |
      Configuration for Falco, runtime security tool and threat detection.
    type: object
    properties:
      enabled:
        title: Falco Enabled
        type: boolean
        default: true
      alerts:
        additionalProperties: false
        title: Falco Alerts
        description: Configure Falco alerts sent from Falco sidekick.
        type: object
        properties:
          enabled:
            title: Falco Alerts Enabled
            type: boolean
            default: false
          type:
            title: Falco Alerts Type
            description: Configure the notification channel for Falco alerts.
            type: string
            default: alertmanager
            enum:
              - alertmanager
              - slack
          hostPort:
            title: Falco Alerts Host Port
            description: Configure the notification channel for Falco alerts.
            type: string
            format: uri
            default: http://alertmanager-operated.monitoring:9093
          priority:
            title: Falco Alerts Priority
            description: Configure the notification priority for Falco alerts.
            type: string
            default: notice
      driver:
        title: Falco Driver
        description: |-
          Configuration for the Falco syscall driver used to collect events.

          See [the upstream documentation](https://falco.org/docs/event-sources/kernel/) for more information.
        type: object
        properties:
          kind:
            title: Falco Driver Kind
            type: string
            default: kmod
            enum:
              - kmod
              - modern-bpf
              - ebpf
            meta:enum:
              kmod: Kernel module (default)
              modern-bpf: Modern eBPF probe
              ebpf: Legacy eBPF probe
        if:
          properties:
            kind:
              const: kmod
        then:
          properties:
            module:
              additionalProperties: false
              title: Falco Kmod Driver Config
              description: Configuration for the Falco Kmod Driver.
              type: object
              properties:
                repoURL:
                  title: Falco Kmod Driver URL
                  description: Override the URL used to download driver modules, e.g. to use a self hosted file server in an air-gapped environment
                  type: string
                  oneOf:
                    - contst: ""
                    - format: uri
        else:
          properties:
            kind:
              type: string
              enum:
                - modern-bpf
                - ebpf
            ebpf:
              additionalProperties: false
              title: Falco eBPF Driver Config
              description: Configuration for the Falco eBPF Driver.
              type: object
              properties:
                hostNetwork:
                  title: Falco eBPF Host Network
                  description: |-
                    Needed to enable eBPF JIT at runtime for performance reasons.
                    Can be skipped if eBPF JIT is enabled from outside the container
                  type: boolean
                  default: false
                path:
                  title: Falco eBPF Path
                  description: |-
                    Path where the eBPF probe is located.
                    It comes in handy when the probe have been installed in the nodes using tools other than the init container deployed with the chart.
                  type: string
                  default: ""
      artifact:
        title: Falcoctl Artifact
        description: |-
          Configure Falcoctl artefact management.

          See [the upstream repository](https://github.com/falcosecurity/falcoctl) for reference.
        additionalProperties: false
        type: object
        properties:
          install:
            title: Falcoctl Artifact Install
            description: Configure Falcoctl artefact install.
            additionalProperties: false
            type: object
            properties:
              enabled:
                title: Falcoctl Artifact Install Enabled
                description: |-
                  Configure Falcoctl to install additional artifacts before Falco starts.

                  Set this to false in an air-gapped environment, unless artifacts are self-hosted and `customIndexes` are configured.
                type: boolean
                default: false
      customIndexes:
        title: Falcoctl Custom Artifact Indices
        description: Configure custom artefact indices for Falcoctl.
        type: array
        items:
          title: Falcoctl Custom Artifact Index
          description: Configure custom artefact index for Falcoctl.
          type: object
          properties:
            name:
              title: Falcoctl Artifact Index Name
              type: string
            url:
              title: Falcoctl Artifact Index URL
              type: string
              format: uri
      rulesFiles:
        title: Falco Rule Files
        description: |-
          Configure standard rules to use in Falco.

          See [the upstream documentation](https://falcosecurity.github.io/rules/) for reference.
        additionalProperties: false
        type: object
        properties:
          default:
            additionalProperties: false
            title: Falco Default Rules
            description: Configure Falco default rules
            type: object
            properties:
              enabled:
                title: Falco Default Rules Enabled
                type: boolean
                default: true
              version:
                title: Falco Default Rules Version
                type: string
                default: 3.0.1
          incubating:
            additionalProperties: false
            title: Falco Incubating Rules
            description: Configure Falco incubating rules
            type: object
            properties:
              enabled:
                title: Falco Incubating Rules Enabled
                type: boolean
                default: false
              version:
                title: Falco Incubating Rules Version
                type: string
                default: 3.0.1
          sandbox:
            additionalProperties: false
            title: Falco Sandbox Rules
            description: Configure Falco sandbox rules
            type: object
            properties:
              enabled:
                title: Falco Sandbox Rules Enabled
                type: boolean
                default: false
              version:
                title: Falco Sandbox Rules Version
                type: string
                default: 3.0.1
      customRules:
        title: Falco Custom Rules
        description: |-
          Configure custom rules to use in Falco.

          > [!note]
          > See [the upstream documentation](https://falco.org/docs/rules/) for reference.
          >
          > The keys will become the file name of the generated rule file, and all files are parsed in alphabetical order.
        additionalProperties:
          format: yaml
          type: string
        type: object
      tty:
        title: Falco Allocate TTY
        description: |-
          Attach the Falco process to a TTY inside the container.

          Needed to flush Falco logs as soon as they are emitted.
        type: boolean
        default: true
      falcoExporter:
        additionalProperties: false
        title: Falco Exporter
        description: Basic configuration for Falco Exporter, the daemon set that exposes Falco alerts to Prometheus.
        type: object
        properties:
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      falcoSidekick:
        additionalProperties: false
        title: Falco Sidekick
        description: Basic configuration for Falco Sidekick, the deployment that forwards Falco alerts to Alertmanager.
        type: object
        properties:
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
      tolerations:
        $ref: '#/$defs/kubernetesTolerations'
      nodeSelector:
        $ref: '#/$defs/kubernetesNodeSelector'
      affinity:
        $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
  gatekeeper:
    title: Open Policy Agent Gatekeeper configuration
    type: object
    properties:
      allowUserCRDs:
        type: object
        properties:
          enabled:
            type: boolean
          enforcement:
            type: string
          adminConfUser:
            description: |-
              The name of the user specified in /etc/kubernetes/admin.conf kubeconfig file of the control plane nodes
              Necessary if Kubespray is used for managing the k8s cluster.
            type: string
          extraCRDs:
            type: array
            items:
              type: object
              properties:
                names:
                  type: array
                  items:
                    type: string
                group:
                  type: string
          extraServiceAccounts:
            type: array
            items:
              type: object
              properties:
                namespace:
                  type: string
                name:
                  type: string
              additionalProperties: false
      enabled:
        type: boolean
    additionalProperties: false
  kured:
    additionalProperties: false
    title: Kured Config
    description: |-
      Configuration for Kured (Kubernetes Reboot Daemon).

      Kured orchestrates node reboots to allow nodes to automatically perform system updates and patches.
    type: object
    properties:
      enabled:
        title: Kured Enabled
        default: false
        type: boolean
      configuration:
        title: Kured Config
        description: |-
          Kured configuration parameters.

          See [the upstream documentation for reference](https://kured.dev/docs/configuration/).
          Most parameters are mapped from `camelCase` to `--kebab-case`, others can be set via `extraArgs`.
        type: object
        properties:
          drainTimeout:
            title: Kured Drain Timeout
            description: |-
              Timeout after which the drain is aborted.

              Default 0, infinite time.
            $ref: '#/$defs/goDuration'
            default: "0"
          timeZone:
            title: Kured Schedule Time Zone
            type: string
            default: UTC
          startTime:
            title: Kured Schedule Start Time
            description: Schedule reboots only after this time of day.
            type: string
            default: 0:00
          endTime:
            title: Kured Schedule End Time
            description: Schedule reboots only before this time of day.
            type: string
            default: 23:59:59
          rebootDays:
            title: Kured Schedule Reboot Days
            description: Only reboot on these days.
            type: array
            items:
              type: string
              examples:
                - mo
                - tu
                - we
                - th
                - fr
                - sa
                - su
            default:
              - mo
              - tu
              - we
              - th
              - fr
              - sa
              - su
          period:
            title: Kured Reboot Check Period
            description: Sentinel check period.
            $ref: '#/$defs/goDuration'
            default: 1h
          lockReleaseDelay:
            title: Kured Reboot Lock Release Delay
            description: Hold lock after reboot by this amount of time.
            $ref: '#/$defs/goDuration'
            default: 5m
      extraArgs:
        $ref: '#/$defs/extraArgs'
      extraEnvVars:
        type: object
      metrics:
        title: Kured Metrics
        description: Configuration for Kured metrics
        additionalProperties: false
        properties:
          enabled:
            title: Kured Metrics Enabled
            type: boolean
            default: true
          interval:
            title: Kured Metrics Duration
            $ref: "#/$defs/goDuration"
            default: 60s
          labels:
            title: Kured Metrics Labels
            type: object
        type: object
      notification:
        title: Kured Notification
        description: Send notification from Kured when nodes are rebooted.
        additionalProperties: false
        type: object
        properties:
          slack:
            title: Kured Slack Notification
            description: Send notification from Kured to Slack when nodes are rebooted.
            additionalProperties: false
            type: object
            properties:
              enabled:
                title: Kured Slack Notification Enabled
                default: false
                type: boolean
              channel:
                title: Kured Slack Notification Channel
                default: ""
                type: string
      dsAnnotations:
        type: object
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
      tolerations:
        $ref: '#/$defs/kubernetesTolerations'
      nodeSelector:
        $ref: '#/$defs/kubernetesNodeSelector'
      affinity:
        $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
  opa:
    additionalProperties: false
    properties:
      audit:
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
          topologySpreadConstraints:
            $ref: '#/$defs/kubernetesTopologySpreadConstraints'
          writeToRAMDisk:
            default: false
            type: boolean
        type: object
      auditChunkSize:
        default: 500
        type: number
      auditFromCache:
        default: false
        type: boolean
      auditIntervalSeconds:
        default: 600
        type: number
      constraintViolationsLimit:
        default: 20
        type: number
      controllerManager:
        $ref: '#/$defs/component'
      disallowedTags:
        additionalProperties: false
        properties:
          enabled:
            default: true
            type: boolean
          enforcement:
            default: deny
            type: string
          tags:
            items:
              default: latest
              type: string
            type: array
        type: object
      imageRegistry:
        additionalProperties: false
        properties:
          URL:
            items:
              examples:
                - harbor.example.com
                - quay.io/jetstack/cert-manager-acmesolver
              type: string
            type: array
          enabled:
            default: true
            type: boolean
          enforcement:
            default: warn
            type: string
        type: object
      mutatingWebhookTimeoutSeconds:
        default: 5
        type: number
      mutations:
        additionalProperties: false
        properties:
          enabled:
            default: true
            type: boolean
          jobTTL:
            additionalProperties: false
            properties:
              enabled:
                default: true
                type: boolean
              ttlSeconds:
                default: 604800
                type: number
            type: object
          ndots:
            additionalProperties: false
            properties:
              enabled:
                default: false
                type: boolean
              labelSelector:
                additionalProperties: false
                properties:
                  matchLabels: {}
                type: object
              ndotAmount:
                default: 3
                type: integer
            type: object
        type: object
      networkPolicies:
        additionalProperties: false
        properties:
          enabled:
            default: true
            type: boolean
          enforcement:
            default: warn
            type: string
        type: object
      rejectLoadBalancerService:
        additionalProperties: false
        description: Prevent the creation of load balancer services when unsupported
        properties:
          enabled:
            type: boolean
          enforcement:
            default: deny
            enum:
              - dryrun
              - warn
              - deny
            type: string
        type: object
      resourceRequests:
        additionalProperties: false
        properties:
          enabled:
            default: true
            type: boolean
          enforcement:
            default: deny
            enum:
              - dryrun
              - warn
              - deny
            type: string
        type: object
      validatingWebhookTimeoutSeconds:
        default: 5
        type: number
      minimumDeploymentReplicas:
        type: object
        properties:
          enabled:
            type: boolean
            default: true
          enforcemenct:
            type: string
            default: warn
            enum:
              - dryrun
              - warn
              - deny
    type: object
  trivy:
    additionalProperties: false
    patternProperties:
      \w+Enabled$:
        $comment: |-
          This definition applies to any key that ends with 'Enabled', which are all
          booleans. In the future it may be desirable to replace this with individual
          entries under `properties` in order to provide documentation for each
          scanner.
        description: Enable or disable various security scanners
        type: boolean
    properties:
      affinity:
        $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      enabled:
        default: true
        type: boolean
      excludeNamespaces:
        description: comma separated list of namespaces (or glob patterns) to be excluded from scanning
        type: string
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
      scanJobs:
        additionalProperties: false
        properties:
          concurrentLimit:
            default: 1
            type: number
          retryDelay:
            default: 1m
            type: string
          timeout:
            default: 5m
            type: string
        type: object
      scanner:
        additionalProperties: false
        description: |
          configurations for an offline / air-gapped environment
          ref: <https://github.com/aquasecurity/trivy-operator/tree/main/deploy/helm#values>
        properties:
          dbRegistry:
            type: string
          dbRepository:
            type: string
          dbRepositoryInsecure:
            type: boolean
          imagePullSecret:
            additionalProperties: false
            description: |
              if authorization is required for pulling from registry, create a pull
              secret in the monitoring namespace and configure the secret name
            properties:
              name:
                type: string
            type: object
          javaDbRegistry:
            type: string
          javaDbRepository:
            type: string
          offlineScanEnabled:
            type: boolean
          registry:
            examples:
              - docker.io: registry.example.org:5000
                gcr.io: registry.example.org:5000
                ghcr.io: registry.example.org:5000
                index.docker.io: registry.example.org:5000
                quay.io: registry.example.org:5000
                registry.k8s.io: registry.example.org:5000
            properties:
              mirror:
                additionalProperties:
                  description: a docker registry
                  examples:
                    - registry.example.org:5000
                  type: string
                type: object
            type: object
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          timeout:
            $ref: '#/$defs/goDuration'
        type: object
      serviceMonitor:
        additionalProperties: false
        properties:
          enabled:
            default: true
            type: boolean
          interval:
            $ref: '#/$defs/timeRange'
        type: object
      tolerations:
        $ref: '#/$defs/kubernetesTolerations'
      vulnerabilityScanner:
        additionalProperties: false
        properties:
          scanOnlyCurrentRevisions:
            default: true
            type: boolean
          scannerReportTTL:
            $ref: '#/$defs/timeRange'
            default: 720h
        type: object
    required:
      - enabled
    title: Trivy security scanner
    type: object
  alerts:
    title: Alerting
    additionalProperties: false
    properties:
      alertTo:
        type: string
      customReceivers:
        type: array
      opsGenie:
        additionalProperties: false
        properties:
          apiUrl:
            default: https://api.eu.opsgenie.com
            format: uri
            type: string
        type: object
      opsGenieHeartbeat:
        additionalProperties: false
        if:
          properties:
            enabled:
              const: true
        properties:
          enabled:
            default: false
            type: boolean
          name:
            type: string
          url:
            default: https://api.eu.opsgenie.com/v2/heartbeats
            format: uri
            type: string
        required:
          - enabled
        then:
          required:
            - name
        type: object
      slack:
        additionalProperties: false
        properties:
          channel:
            type: string
          customTemplate:
            type: object
        type: object
    type: object
  grafana:
    title: Grafana
    additionalProperties: false
    properties:
      ops:
        additionalProperties: false
        properties:
          additionalConfigValues:
            type: object
          additionalDatasources:
            type: object
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          enabled:
            default: true
            type: boolean
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          oidc:
            additionalProperties: false
            properties:
              allowedDomains:
                items:
                  type: string
                type: array
              enabled:
                default: true
                type: boolean
              scopes:
                default: openid profile email groups
                type: string
              userGroups:
                additionalProperties: false
                properties:
                  grafanaAdmin:
                    default: grafana_admin
                    type: string
                  grafanaEditor:
                    default: grafana_editor
                    type: string
                  grafanaViewer:
                    default: grafana_viewer
                    type: string
                type: object
              skipRoleSync:
                type: boolean
            type: object
          plugins:
            type: array
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          sidecar:
            additionalProperties: false
            properties:
              resources:
                $ref: '#/$defs/kubernetesResourceRequirements'
            type: object
          subdomain:
            default: grafana
            type: string
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
          trailingDots:
            default: true
            type: boolean
          viewersCanEdit:
            default: true
            type: boolean
        type: object
      user:
        $ref: '#/properties/grafana/properties/ops'
    type: object
  grafanaLabelEnforcer:
    title: Grafana Label Enforcer
    additionalProperties: false
    properties:
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
    type: object
  kubeStateMetrics:
    title: Kubernetes Metrics
    additionalProperties: false
    properties:
      clusterAPIMetrics:
        additionalProperties: false
        properties:
          enabled:
            default: false
            type: boolean
        type: object
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
    type: object
  metricsServer:
    additionalProperties: false
    properties:
      enabled:
        default: true
        type: boolean
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
    type: object
  openstackMonitoring:
    title: Openstack Monitoring
    additionalProperties: false
    properties:
      enabled:
        default: false
        type: boolean
    type: object
  prometheus:
    title: Prometheus Config
    description: |-
      Configure Prometheus.

      Prometheus automatically collects metrics via ServiceMonitors, PodMonitors, and Probes, and pushes metrics to Thanos for long term storage.
      Additionally Prometheus evaluates recording rules for both service and workload cluster, and all alerting rules for the workload cluster.

      > [!note]
      > Prometheus is installed in both service cluster and workload cluster, so this configuration applies there with some exceptions.
    type: object
    $defs:
      capacityManagementAlerts:
        title: Capacity Management Alerts
        description: Definitions for capacity management alerts.
        type: object
        properties:
          persistentVolume:
            title: Capacity Management Alerts Persistent Volumes
            description: Configure capacity management alerts on persistent volumes.
            type: object
            additionalProperties: false
            properties:
              enabled:
                $ref: "#/properties/prometheus/$defs/capacityManagementAlerts/properties/persistentVolumeEnabled"
              limit:
                $ref: "#/properties/prometheus/$defs/capacityManagementAlerts/properties/persistentVolumeLimit"
          persistentVolumeEnabled:
            title: Capacity Management Alerts Persistent Volumes Enabled
            type: boolean
            default: true
          persistentVolumeLimit:
            title: Capacity Management Alerts Persistent Volumes Enabled
            description: Alert when a persistent volume's usage reaches the limit in percent.
            type: number
            default: 75

          disklimit:
            title: Capacity Management Alerts Disk Limit
            description: Alert when a disk's usage reaches the limit in percent.
            type: number
            default: 75

          requestlimit:
            title: Capacity Management Alerts Request Limit
            description: Alert when a node's resource requests reaches the limits in percent.
            type: object
            additionalProperties: false
            properties:
              cpu:
                title: Capacity Management Alerts CPU Request Limit
                $ref: "#/properties/prometheus/$defs/capacityManagementAlerts/properties/requestlimitList"
              memory:
                title: Capacity Management Alerts Memory Request Limit
                $ref: "#/properties/prometheus/$defs/capacityManagementAlerts/properties/requestlimitList"
          requestlimitList:
            title: Capacity Management Alerts Request Limit List
            description: Configure a list of node patterns and request limits to alert for.
            type: array
            items:
              $ref: "#/properties/prometheus/$defs/capacityManagementAlerts/properties/requestlimitTerm"
          requestlimitTerm:
            title: Capacity Management Alerts Request Limit Term
            description: Configure a node pattern and the request limit to alert for.
            type: object
            additionalProperties: false
            properties:
              name:
                type: string
                examples:
                  - worker
              pattern:
                type: string
                examples:
                  - .*-worker-.*
              limit:
                type: number
                examples:
                  - 80

      diskAlerts:
        title: Disk Alerts
        description: Definitions for disk alerts.
        type: object
        additionalProperties: false
        properties:
          storage:
            title: Disk Alerts Storage
            description: Configure disk alerts based on storage usage.
            type: object
            additionalProperties: false
            properties:
              predictLinear:
                $ref: "#/properties/prometheus/$defs/diskAlerts/properties/patternRules"
              space:
                $ref: "#/properties/prometheus/$defs/diskAlerts/properties/patternRules"

          inode:
            title: Disk Alerts Inode
            description: Configure disk alerts based on inode usage.
            type: object
            additionalProperties: false
            properties:
              predictLinear:
                $ref: "#/properties/prometheus/$defs/diskAlerts/properties/patternRules"
              space:
                $ref: "#/properties/prometheus/$defs/diskAlerts/properties/patternRules"

          patternRules:
            title: Disk Alert Pattern Rules
            description: Configure disk alerts when disk usage is predicted to reach the limit.
            type: array
            items:
              $ref: "#/properties/prometheus/$defs/diskAlerts/properties/patternRule"
          patternRule:
            title: Disk Alert Pattern Rule
            description: |-
              Configure disk alerts when disk usage is predicted to reach the limit.

              The `hours` key is only supported when configured under `predictLinear`.
            type: object
            additionalProperties: false
            properties:
              hours:
                title: Alert Rule Prediction Window
                type: number
                default: 24
              freeSpacePercentage:
                $ref: '#/$defs/percentage'
                default: 5
              for:
                $ref: '#/$defs/timeRange'
                default: 1h
              severity:
                title: Alert Rule Severity
                type: string
                default: warning
              pattern:
                $ref: "#/properties/prometheus/$defs/diskAlerts/properties/patterns"
          patterns:
            title: Disk Alert Patterns
            description: Select applicable nodes and disks to include or exclude using patterns.
            type: object
            additionalProperties: false
            properties:
              include:
                $ref: "#/properties/prometheus/$defs/diskAlerts/properties/pattern"
              exclude:
                $ref: "#/properties/prometheus/$defs/diskAlerts/properties/pattern"
          pattern:
            title: Disk Alert Pattern
            description: Select applicable nodes and disks using patterns.
            type: object
            additionalProperties: false
            properties:
              node:
                title: Disk Alert Node Pattern
                type: string
                default: ""
              disk:
                title: Disk Alert Disk Pattern
                type: string
                default: ""

          perf:
            title: Disk Alerts Perf
            description: Configure performance disk alerts.
            type: object
            properties:
              enabled:
                $ref: "#/properties/prometheus/$defs/diskAlerts/properties/perfEnabled"
              queueSizeThreshold:
                $ref: "#/properties/prometheus/$defs/diskAlerts/properties/perfQueueSizeThreshold"
              readWaitTimeThreshold:
                $ref: "#/properties/prometheus/$defs/diskAlerts/properties/perfReadWaitTimeThreshold"
              writeWaitTimeThreshold:
                $ref: "#/properties/prometheus/$defs/diskAlerts/properties/perfWriteWaitTimeThreshold"
          perfEnabled:
            title: Disk Alerts Perf Enabled
            type: boolean
          perfQueueSizeThreshold:
            title: Disk Alerts Perf Queue Size
            type: number
            default: 0.5
          perfReadWaitTimeThreshold:
            title: Disk Alerts Perf Read Wait
            type: number
            default: 0.01
          perfWriteWaitTimeThreshold:
            title: Disk Alerts Perf Write Wait
            type: number
            default: 0.1

      s3BucketAlerts:
        title: S3 Bucket Alerts
        description: Definitions for S3 bucket alerts.
        type: object
        additionalProperties: false
        properties:
          objects:
            title: S3 Bucket Alerts Objects
            description: Alert when an S3 buckets reaches the set percentage of the set number of objects.
            type: object
            additionalProperties: false
            properties:
              enabled:
                title: S3 Bucket Alerts Objects Enabled
                type: boolean
                default: false
              percent:
                title: S3 Bucket Alerts Objects Percentage
                $ref: '#/$defs/percentage'
                default: 80
              count:
                title: S3 Bucket Alerts Objects Quota
                default: 1638400
                type: number
          size:
            title: S3 Bucket Alerts Size
            description: Alert when an S3 bucket reaches the set percentage of the set size.
            type: object
            additionalProperties: false
            properties:
              enabled:
                title: S3 Bucket Alerts Size Enabled
                type: boolean
                default: false
              percent:
                title: S3 Bucket Alerts Size Percentage
                $ref: '#/$defs/percentage'
                default: 80
              sizeQuotaGB:
                title: S3 Bucket Alerts Size Quota
                type: number
                default: 1000
          totalSize:
            title: S3 Bucket Alerts Total Size
            description: Alert when all S3 buckets reaches the set percentage of the set size.
            type: object
            additionalProperties: false
            properties:
              enabled:
                title: S3 Bucket Alerts Total Size Enabled
                type: boolean
                default: false
              percent:
                title: S3 Bucket Alerts Total Size Percentage
                $ref: '#/$defs/percentage'
                default: 80
              sizeQuotaGB:
                title: S3 Bucket Alerts Total Size Quota
                type: number
                default: 1000
          exclude:
            title: S3 Bucket Alerts Exclude
            description: Exclude buckets from S3 alerts.
            type: array
            items:
              title: S3 Bucket Name
              type: string

    additionalProperties: false
    properties:
      replicas:
        title: Prometheus Relicas
        type: number
        default: 1
      storage:
        title: Prometheus Storage
        description: Configure the persistent volume claim used for Promtheus storage.
        additionalProperties: false
        properties:
          enabled:
            title: Proemtheus Storage Enabled
            description: |-
              By default Prometheus instances run without storage and are treated as ephemeral.
              See [ADR-0007](https://elastisys.io/compliantkubernetes/adr/0007-make-monitoring-forwarders-storage-independent/) for context.
            type: boolean
            default: false
          size:
            title: Proemtheus Storage Size
            type: string
            default: 5Gi
        type: object
      retention:
        title: Prometheus Retention
        description: Configure retention for Prometheus.
        type: object
        additionalProperties: false
        properties:
          age:
            title: Prometheus Retention Age
            description: Configure the time range Prometheus will retain metrics for.
            type: string
            default: 3d
          size:
            title: Prometheus Retention Size
            description: Configure the total size Prometheus will retain metrics for.
            type: string
            default: 4GiB
          alertmanager:
            title: Prometheus Retention Alertmanager
            description: Configure the time range Alertmanager will retain metrics for.
            $ref: '#/$defs/timeRange'
            default: 72h
      additionalScrapeConfigs:
        title: Prometheus Additional Scrape Configs
        description: |-
          Configure additional scrape configs for Prometheus.

          > [!note]
          > See [the upstream documentation](https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config) for reference.
        type: array
      alertmanagerSpec:
        title: Alertmanager Config
        description: |-
          Configure service cluster Alertmanager.

          Alertmanager receives alerts from Prometheus and Thanos and forwards them to the configured notification channel.

          > [!note]
          > Alertmanager is installed in both service cluster and workload cluster, however this configuration key only applies to the service cluster, use `user.alertmanager` to configure it in the workload cluster.
        type: object
        additionalProperties: false
        properties:
          replicas:
            title: Alertmanager Replicas
            type: number
            default: 2
          storage:
            title: Alertmanager Storage
            description: Configure persistent storage for Alertmanager.
            type: object
            additionalProperties: false
            properties:
              volumeClaimTemplate:
                title: Alertmanager Volume Claim Template
                description: Configure persistent storage for Alertmanager.
                type: object
                additionalProperties: false
                properties:
                  spec:
                    title: Alertmanager Volume Claim Spec
                    description: Configure persistent storage for Alertmanager.
                    type: object
                    additionalProperties: false
                    properties:
                      accessModes:
                        title: Alertmanager Volume Access Mode
                        description: Configure the access mode of the persistent storage for Alertmanager.
                        type: array
                        items:
                          type: string
                          default: ReadWriteOnce
                      resources:
                        title: Alertmanager Volume Resources
                        description: Configure the resources of the persistent storage for Alertmanager.
                        $ref: '#/$defs/kubernetesResourceRequirements'
          groupBy:
            title: Alertmanager Group By
            description: |-
              Configure Alertmanager to group certain alerts based on labels.

              > [!note]
              > See [the upstream documentation](https://prometheus.io/docs/alerting/latest/configuration/) for reference.
            items:
              default: '...'
              type: string
            type: array
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          topologySpreadConstraints:
            $ref: '#/$defs/kubernetesTopologySpreadConstraints'
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      capacityManagementAlerts:
        title: Capacity Management Alerts
        description: Configure capacity management alerts.
        type: object
        additionalProperties:
          type: number
        properties:
          enabled:
            title: Capacity Management Alerts Enabled
            type: boolean
            default: true
          predictUsage:
            title: Capacity Management Alerts Predict Usage
            type: boolean
            default: false
          persistentVolume:
            $ref: "#/properties/prometheus/$defs/capacityManagementAlerts/properties/persistentVolume"
          disklimit:
            $ref: "#/properties/prometheus/$defs/capacityManagementAlerts/properties/disklimit"
          requestlimit:
            $ref: "#/properties/prometheus/$defs/capacityManagementAlerts/properties/requestlimit"
          usagelimit:
            default: 95
            type: number
      diskAlerts:
        title: Disk Alerts
        description: Configure disk alerts.
        type: object
        additionalProperties: false
        properties:
          storage:
            $ref: "#/properties/prometheus/$defs/diskAlerts/properties/storage"
          inode:
            $ref: "#/properties/prometheus/$defs/diskAlerts/properties/inode"
          perf:
            $ref: "#/properties/prometheus/$defs/diskAlerts/properties/perf"
      s3BucketAlerts:
        title: S3 Bucket Alerts
        description: Configure S3 bucket alerts.
        type: object
        additionalProperties: false
        properties:
          objects:
            $ref: "#/properties/prometheus/$defs/s3BucketAlerts/properties/objects"
          size:
            $ref: "#/properties/prometheus/$defs/s3BucketAlerts/properties/size"
          totalSize:
            $ref: "#/properties/prometheus/$defs/s3BucketAlerts/properties/totalSize"
          exclude:
            $ref: "#/properties/prometheus/$defs/s3BucketAlerts/properties/exclude"
      webhookAlerts:
        title: Webhook Alerts
        description: Configure webhook alerts.
        type: object
        properties:
          enabled:
            title: Webhook Alerts Enabled
            type: boolean
            default: true
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
      tolerations:
        $ref: '#/$defs/kubernetesTolerations'
      topologySpreadConstraints:
        $ref: '#/$defs/kubernetesTopologySpreadConstraints'
      nodeSelector:
        $ref: '#/$defs/kubernetesNodeSelector'
      affinity:
        $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
  prometheusOperator:
    title: Prometheus Operator
    description: Configure Prometheus Operator.
    type: object
    additionalProperties: false
    properties:
      prometheusConfigReloader:
        title: Prometheus Operator Config Reloader
        description: Configure Prometheus Operator config reloader.
        type: object
        additionalProperties: false
        properties:
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
  prometheusBlackboxExporter:
    title: Prometheus Blackbox Exporter
    description: Configure Prometheus Blackbox Exporter, the exporter used for probing endpoints.
    type: object
    additionalProperties: false
    properties:
      targets:
        title: Prometheus Blackbox Exporter Targets
        description: Configure the targets Prometheus Blackbox Exporter should probe.
        type: object
        additionalProperties:
          type: boolean
      customKubeapiTargets:
        title: Prometheus Blackbox Exporter Custom Kube API Targets
        description: Configure custom Kube API targets Prometheus Blackbox Exporter should probe.
        type: array
        items:
          title: Custom Kube API target
          description: Custom Kube API target Prometheus Blackbox Exporter should probe.
          type: object
          additionalProperties: false
          properties:
            name:
              title: Custom Kube API Target Name
              type: string
            domain:
              title: Custom Kube API Target Domain
              type: string
              format: hostname
      hostAliases:
        title: Host Aliases
        description: Configure host aliases to resolve internally within the Pod.
        type: array
        items:
          title: Host Alias
          description: Configure a host alias to resolve internally within the Pod.
          type: object
          additionalProperties: false
          properties:
            hostNames:
              title: Host Names
              description: Configure the hostname for the host alias.
              type: array
              items:
                title: Host Name
                type: string
            ip:
              title: IP Address
              description: Configure the IP address for the host alias.
              type: string
              format: ipv4
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
  prometheusNodeExporter:
    title: Prometheus Node Exporter
    description: Configure Prometheus Node Exporter, the exporter used for collecting node metrics.
    type: object
    additionalProperties: false
    properties:
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
  s3Exporter:
    title: S3 Exporter
    additionalProperties: false
    properties:
      affinity:
        $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      enabled:
        default: true
        type: boolean
      interval:
        default: 60m
        type: string
      nodeSelector:
        $ref: '#/$defs/kubernetesNodeSelector'
      resources:
        $ref: '#/$defs/kubernetesResourceRequirements'
      scrapeTimeout:
        default: 10m
        type: string
      tolerations:
        $ref: '#/$defs/kubernetesTolerations'
    type: object
  thanos:
    title: Thanos Config
    description: |-
      Configuration for Thanos.

      Thanos ingests metrics sent from Prometheus in both the service and workload clusters, and stores them in object storage.

      This requires that `objectStorage` is configured, and will use the bucket or container set in `objectStorage.buckets.thanos`.

      > [!note]
      > Thanos and its components are installed in the service cluster, so this configuration mainly applies there.
    type: object
    additionalProperties: false
    properties:
      enabled:
        title: Thanos Enabled
        description: |-
          > [!note]
          > Must be set for both service and workload cluster.
        type: boolean
        default: true
      objectStorage:
        title: Thanos Object Storage
        description: |-
          Configure Object Storage for Thanos.

          Allows for using OpenStack Swift as the object storage backend type.
        additionalProperties: false
        properties:
          type:
            title: Thanos Object Storage Type
            default: ""
            type: string
            enum:
              - ""
              - swift
            meta:enum:
              "": Use global object storage type (default).
              swift: Use OpenStack Swift object storage type.
        type: object
      bucketweb:
        title: Thanos Bucket Web
        description: Configure Thanos Bucket Web, the UI to view the state of the bucket or container in use by Thanos.
        type: object
        additionalProperties: false
        properties:
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
      compactor:
        title: Thanos Compactor
        description: |-
          Configure Thanos Compactor, the component compacting and deduplicating metrics stored by Thanos.

          > [!note]
          > See [the upstream documentation](https://thanos.io/tip/components/compact.md/) for reference.
        type: object
        additionalProperties: false
        properties:
          verticalCompaction:
            title: Thanos Vertical Compactor
            description: When enabled series of metrics from multiple replicas will be merged into one.
            type: boolean
            default: false
          deduplication:
            title: Thanos Deduplication
            description: Configure deduplication of metrics.
            type: string
            default: none
            enum:
              - none
              - receiverReplicas
              - prometheusReplicas
            meta:enum:
              none: Disable deduplication of metrics (default).
              receiverReplicas: Enable light deduplication of metrics from different Thanos Receiver replicas.
              prometheusReplicas: Enable heavy deduplication of metrics from different Prometheus replicas.
          persistence:
            title: Thanos Compactor Persistence
            description: Configure persistence for Thanos Compactor.
            type: object
            additionalProperties: false
            properties:
              enabled:
                title: Thanos Compactor Persistence Enabled
                type: boolean
                default: true
              size:
                title: Thanos Compactor Persistence Size
                type: string
                default: 8Gi
          retentionResolutionRaw:
            description: The retention duration of metrics with raw resolution.
            $ref: '#/$defs/timeRange'
            default: 30d
          retentionResolution5m:
            description: The retention duration of metrics with 5m resolution.
            $ref: '#/$defs/timeRange'
            default: 90d
          retentionResolution1h:
            description: The retention duration of metrics with 1h resolution.
            $ref: '#/$defs/timeRange'
            default: 0s
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
      queryFrontend:
        title: Thanos Query Frontend
        description: Configure Thanos Query Frontend, the component serving query requests from Grafana.
        type: object
        additionalProperties: false
        properties:
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
      query:
        title: Thanos Query
        description: Configure Thanos Query, the component executing metric queries.
        type: object
        additionalProperties: false
        properties:
          enabled:
            title: Thanos Query Enabled
            type: boolean
            default: true
          replicaCount:
            title: Thanos Query Replicas
            type: number
            default: 1
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          topologySpreadConstraints:
            $ref: '#/$defs/kubernetesTopologySpreadConstraints'
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      receiveDistributor:
        title: Thanos Receive Distributor
        description: |-
          Configure Thanos Receive Distributor, the component serving remote write requests from Prometheus.

          Also called routing receiver upstream.
        type: object
        additionalProperties: false
        properties:
          replicationFactor:
            title: Thanos Replication Factor
            description: Requires that incoming remote write requests are replicated `(replicationFactor + 1) / 2`.
            type: number
            default: 1
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
      receiver:
        title: Thanos Receiver
        description: |-
          Configure Thanos Receiver, the component ingesting metrics collected by Prometheus and storing them in object storage.

          Also called ingesting receiver upstream.
        additionalProperties: false
        properties:
          enabled:
            title: Thanos Receiver Enabled
            type: boolean
            default: true
          mode:
            title: Thanos Receiver Mode
            type: string
            default: dual-mode
            enum:
              - standalone
              - dual-mode
            meta:enum:
              standalone: Run only the ingesting receiver
              dual-mode: Run both the routing and ingesting receiver
          basic_auth:
            title: Thanos Receiver Basic Auth
            description: Configure authentication to Thanos Receiver,
            additionalProperties: false
            properties:
              username:
                title: Thanos Receiver Basic Auth Username
                description: |-
                  Configure the username for authenticating to Thanos Receiver.

                  > [!note]
                  > Must be set for both service and workload clusters.
                type: string
                default: thanos
            type: object
          subdomain:
            title: Thanos Receive Subdomain
            description: |-
              Subdomain of `opsDomain` that the Ingress to Thanos Receive will be created with.

              > [!note]
              > Must be set for both service and workload clusters.
            type: string
            format: hostname
            default: thanos-receiver
          outOfOrderTimeWindow:
            title: Thanos Out Of Order Time Window
            type: string
            default: 600s
          tsdbRetention:
            title: Thanos TSDB Retention
            type: string
            default: 15d
          replicaCount:
            title: Thanos Receiver Replcias
            type: number
            default: 2
          persistence:
            title: Thanos Receiver Persistence
            description: Configure persistence for Thanos Receiver.
            type: object
            additionalProperties: false
            properties:
              enabled:
                title: Thanos Receiver Persistence Enabled
                type: boolean
                default: true
              size:
                title: Thanos Receiver Persistence Size
                type: string
                default: 50Gi
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          topologySpreadConstraints:
            $ref: '#/$defs/kubernetesTopologySpreadConstraints'
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
        type: object
      ruler:
        title: Thanos Ruler
        description: Configure Thanos Ruler, the component evaluating alerting and recording rules.
        type: object
        additionalProperties: false
        properties:
          enabled:
            title: Thanos Ruler Enabled
            type: boolean
            default: true
          replicaCount:
            title: Thanos Ruler Replcias
            type: number
            default: 2
          persistence:
            title: Thanos Ruler Persistence
            description: Configure persistence for Thanos Ruler.
            type: object
            additionalProperties: false
            properties:
              enabled:
                title: Thanos Ruler Persistence Enabled
                type: boolean
                default: false
              size:
                title: Thanos Ruler Persistence Size
                type: string
                default: 8Gi
          configReloader:
            title: Thanos Ruler Config Reloader
            description: Configure the config reloader sidecar for Thanos Ruler.
            type: object
            additionalProperties: false
            properties:
              resources:
                $ref: '#/$defs/kubernetesResourceRequirements'
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          topologySpreadConstraints:
            $ref: '#/$defs/kubernetesTopologySpreadConstraints'
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      storegateway:
        title: Thanos Store Gateway
        description: Configure Thanos Store Gateway, the component fetching metrics from object storage.
        type: object
        additionalProperties: false
        properties:
          persistence:
            title: Thanos Store Gateway Persistence
            description: Configure persistence for Thanos Store Gateway.
            type: object
            additionalProperties: false
            properties:
              size:
                title: Thanos Store Gateway Persistence Size
                type: string
                default: 8Gi
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
      metrics:
        title: Thanos Metrics
        description: Configure metrics collected from Thanos.
        type: object
        additionalProperties: false
        properties:
          enabled:
            title: Thanos Metrics Enabled
            type: boolean
            default: true
          serviceMonitor:
            title: Thanos Metrics Service Monitor
            description: Configure the service monitor used to collect metrics from Thanos.
            type: object
            additionalProperties: false
            properties:
              enabled:
                title: Thanos Metrics Service Monitor Enabled
                type: boolean
                default: true
  wcProbeIngress:
    title: Workcload Cluster Ingress Probe
    additionalProperties: false
    properties:
      enabled:
        type: boolean
    type: object
  welcomingDashboard:
    title: Welcoming Dashboard
    additionalProperties: false
    description: |-
      If you want to add extra text to the grafana/opensearch "welcoming dashboards"
      then write the text in these values as a one-line string.
      Note, first line of the string is a header, not all characters are supported.
      For newline in Grafana dashboard use format `\\n`
    properties:
      extraTextGrafana:
        description: Extra text added to the Grafana welcoming dashboard.
        examples:
          - Hello\n\n[This is an example link](https:/elastisys.io)
        format: markdown
        type: string
      extraTextOpensearch:
        description: Extra text added to the Opensearch welcoming dashboard.
        format: markdown
        type: string
      extraVersions:
        description: List of additional components to list on the welcoming dashboard.
        items:
          additionalProperties: false
          properties:
            name:
              description: Name of the component.
              examples:
                - Dex
                - Postgres
              type: string
            releasenotes:
              description: Link to release notes for the component
              examples:
                - https://elastisys.io/compliantkubernetes/release-notes/
              format: uri
              type: string
            subdomain:
              description: Link to a subdomain of `.global.baseDomain`
              format: hostname
              type: string
            url:
              description: Link to a full URL, instead of `subdomain`
              examples:
                - https://www.postgresql.org/
              format: uri
              type: string
            version:
              description: Version number.
              examples:
                - v2.37
                - "11"
              type: string
          required:
            - name
          type: object
        type: array
    type: object
  fluentd:
    title: Fluentd
    additionalProperties: false
    properties:
      aggregator:
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          buffer:
            $ref: '#/$defs/fluentdBuffer'
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          persistence:
            additionalProperties: false
            properties:
              storage:
                default: 10Gi
                type: string
            type: object
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
        type: object
      audit:
        additionalProperties: false
        properties:
          compaction:
            additionalProperties: false
            properties:
              days:
                default: 10
                type: number
              enabled:
                default: true
                type: boolean
              ephemeralVolumes:
                additionalProperties: false
                properties:
                  enabled:
                    default: false
                    type: boolean
                type: object
              schedule:
                default: 0 1/6 * * *
                type: string
            type: object
          enabled:
            default: false
            type: boolean
          filters:
            default: ""
            description: Add filter stages to capture audit logs, add the audit tag prefix
            type: string
          retention:
            additionalProperties: false
            properties:
              days:
                default: 30
                type: number
              enabled:
                default: true
                type: boolean
              schedule:
                default: 0 20 * * *
                type: string
            type: object
        type: object
      enabled:
        default: true
        type: boolean
      forwarder:
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          buffer:
            type: object
          livenessThresholdSeconds:
            default: 900
            type: number
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          requestTimeout:
            default: 60s
            type: string
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          stuckThresholdSeconds:
            default: 1200
            type: number
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
          topologySpreadConstraints:
            $ref: '#/$defs/io.k8s.api.core.v1.TopologySpreadConstraint'
        type: object
      logManager:
        additionalProperties: false
        properties:
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
          compaction:
            additionalProperties: false
            properties:
              resources:
                $ref: '#/$defs/kubernetesResourceRequirements'
              volume:
                additionalProperties: false
                properties:
                  storage:
                    default: 5Gi
                    type: string
                type: object
            type: object
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          retention:
            additionalProperties: false
            properties:
              resources:
                $ref: '#/$defs/kubernetesResourceRequirements'
            type: object
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
        type: object
      scLogs:
        additionalProperties: false
        properties:
          compaction:
            additionalProperties: false
            properties:
              days:
                default: 7
                type: number
              enabled:
                default: true
                type: boolean
              ephemeralVolumes:
                additionalProperties: false
                properties:
                  enabled:
                    default: false
                    type: boolean
                type: object
              schedule:
                default: 0 2/6 * * *
                type: string
            type: object
          enabled:
            default: true
            type: boolean
          retention:
            additionalProperties: false
            properties:
              days:
                default: 7
                type: number
              enabled:
                default: true
                type: boolean
              schedule:
                default: 0 21 * * *
                type: string
            type: object
        type: object
      user:
        $ref: '#/$defs/component'
      extraConfigMaps:
        type: object
        description: |
          Extra fluentd config to mount.
        properties: {}
        additionalProperties:
          type: string
          description: configmap content
    type: object
  opensearch:
    title: OpenSearch Config
    description: |-
      Configuration for OpenSearch.

      OpenSearch ingests logs sent from Fluentd in the workload cluster, and presents them in OpenSearch Dashboards.

      > [!note]
      > OpenSearch and its components are installed in the service cluster, so this configuration mainly applies there.
    type: object
    additionalProperties: false
    $defs:
      node:
        title: OpenSearch Node
        description: Definitions for OpenSearch nodes.
        type: object
        properties:
          javaOpts:
            title: OpenSearch Node Java Options
            description: |-
              Set Java Virtual Machine Options to control the memory allocation of OpenSearch.

              As a rule of thumb the minimum allocation `-Xms` and maximum allocation `-Xmx` arguments should be the same to be more predictable.
              Additionally until memory allocation is at 2 GiB and more it is recommended that the memory limit set in Kubernetes is twice the allocation as OpenSearch uses this for cache.
            type: string
            default: -Xms512m -Xmx512m
          storageClass:
            title: OpenSearch Node Storage Class
            type:
              - string
              - "null"
            description: |-
              Set storage class for OpenSearch.

              - If set to `null`, the default storage class will be used to provision the volumes.
              - If set to `-`, no storage class will be used to provision the volumes.
          storageSize:
            title: OpenSearch Node Storage Size
            description: Configure the requested size of the persistent volume for this OpenSerch node.
            type: string
      role:
        title: OpenSearch Role
        description: Definitions for OpenSearch roles.
        type: object
        properties:
          name:
            title: OpenSearch Role Name
            description: Configures the name of the create role.
            type: string
          definition:
            title: OpenSearch Role Definition
            description: Configures the permissions the role will have.
            $comment: This schema does not cover the entire upstream object.
            type: object
            properties:
              cluster_permissions:
                $ref: "#/properties/opensearch/$defs/role/properties/clusterPermissions"
              index_permissions:
                $ref: "#/properties/opensearch/$defs/role/properties/indexPermissions"
          clusterPermissions:
            title: OpenSearch Role Cluster Permissions
            description: Configure permissions that applies cluster-wide.
            type: array
            items:
              title: OpenSearch Cluster Permission
              type: string
          indexPermissions:
            title: OpenSearch Role Index Permissions
            description: Configure permissions that applies per index.
            type: array
            items:
              title: OpenSearch Role Index Permission
              description: Configure permission that applies per index.
              type: object
              properties:
                index_patterns:
                  $ref: "#/properties/opensearch/$defs/role/properties/indexPatterns"
                allowed_actions:
                  $ref: "#/properties/opensearch/$defs/role/properties/allowedActions"
          indexPatterns:
            title: OpenSearch Role Index Patterns
            description: Configure the index pattern this permission applies to.
            type: array
            items:
              title: OpenSearch Role Index Pattern
              type: string
          allowedActions:
            title: OpenSearch Role Allowed Actions
            description: Configure the actions this permission allows.
            type: array
            items:
              title: OpenSearch Role Allowed Action
              type: string
      roleMapping:
        title: OpenSearch Role Mapping
        description: Definitions for OpenSearch role mappings.
        type: object
        properties:
          name:
            title: OpenSearch Role Mapping Name
            type: string
          definition:
            title: OpenSearch Role Mapping Definition
            description: Configures the backend roles or groups and users the role mapping applies to.
            $comment: This schema does not cover the entire upstream object.
            type: object
            properties:
              backend_roles:
                $ref: "#/properties/opensearch/$defs/roleMapping/properties/groups"
              users:
                $ref: "#/properties/opensearch/$defs/roleMapping/properties/users"
          groups:
            title: OpenSearch Role Mapping Groups
            description: Configures the backend roles or groups that this role mapping applies to.
            type: array
            items:
              type: string
          users:
            title: OpenSearch Role Mapping Users
            description: Configures the user that this role mapping applies to.
            type: array
            items:
              type: string
    properties:
      enabled:
        title: OpenSearch Enabled
        description: |-
          > [!note]
          > Must be set for both service and workload cluster.
        type: boolean
        default: true
      clusterName:
        title: OpenSearch Cluster Name
        default: opensearch
        type: string
      subdomain:
        title: OpenSearch Subdomain
        description: |-
          Subdomain of `opsDomain` that the Ingress to OpenSearch will be created with.

          > [!note]
          > Must be set for both service and workload cluster.
        type: string
        format: hostname
        default: opensearch
      sso:
        title: OpenSearch Single Sign On
        description: Configures Single Sign On to OpenSearch via Dex.
        type: object
        additionalProperties: false
        properties:
          enabled:
            title: OpenSearch Single Sign On
            default: false
            type: boolean
          scope:
            title: OpenSearch Single Sign On Scopes
            default: openid profile email groups
            type: string
          subjectKey:
            title: OpenSearch Single Sign On Subject Key
            default: email
            type: string
          rolesKey:
            title: OpenSearch Single Sign On Roles Key
            default: groups
            type: string
      dashboards:
        title: OpenSearch Dashboards
        description: |-
          Configures the Dashboards deployment of OpenSearch providing the UI to view and query logs.
        type: object
        additionalProperties: false
        properties:
          subdomain:
            title: OpenSearch Dashboards Subdomain
            description: |-
              Subdomain of `baseDomain` that the Ingress to OpenSearch Dashboards will be created with.

              > [!note]
              > Must be set for both service and workload cluster.
            default: opensearch
            type: string
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
          topologySpreadConstraints:
            $ref: '#/$defs/kubernetesTopologySpreadConstraints'
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      masterNode:
        title: OpenSearch Master Node
        description: |-
          Configures the main stateful set of OpenSearch that takes on all roles not provided by other nodes (`dataNode`, `clientNode`).
        type: object
        additionalProperties: false
        properties:
          count:
            title: OpenSearch Master Node Replicas
            default: 1
            type: number
          javaOpts:
            $ref: "#/properties/opensearch/$defs/node/properties/javaOpts"
          storageClass:
            $ref: "#/properties/opensearch/$defs/node/properties/storageClass"
          storageSize:
            $ref: "#/properties/opensearch/$defs/node/properties/storageSize"
            default: 8Gi
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      dataNode:
        title: OpenSearch Data Node
        description: |-
          Configures the data stateful set of OpenSearch that takes on the roll to index and store logs.
        type: object
        additionalProperties: false
        properties:
          dedicatedPods:
            title: OpenSearch Data Node Enabled
            description: When disabled the master nodes will take on these rolls.
            type: boolean
            default: true
          count:
            title: OpenSearch Data Node Replicas
            type: number
            default: 2
          javaOpts:
            $ref: "#/properties/opensearch/$defs/node/properties/javaOpts"
          storageClass:
            $ref: "#/properties/opensearch/$defs/node/properties/storageClass"
          storageSize:
            $ref: "#/properties/opensearch/$defs/node/properties/storageSize"
            default: 25Gi
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      clientNode:
        title: OpenSearch Client Node
        description: |-
          Configures the client stateful set of OpenSearch that takes on the roll to ingest and query logs.
        type: object
        additionalProperties: false
        properties:
          dedicatedPods:
            title: OpenSearch Client Node Enabled
            description: When disabled the master nodes will take on these rolls.
            type: boolean
            default: true
          count:
            title: OpenSearch Client Node Replicas
            type: number
            default: 1
          javaOpts:
            $ref: "#/properties/opensearch/$defs/node/properties/javaOpts"
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      extraRoles:
        title: OpenSearch Extra Roles
        description: Configures extra roles for OpenSearch Security.
        type: array
        items:
          title: OpenSearch Role
          description: |-
            Configures a role for OpenSearch Security.

            > [!note]
            > See [the upstream documentation](https://opensearch.org/docs/latest/security/configuration/yaml/#rolesyml) for reference.
          type: object
          additionalProperties: false
          properties:
            role_name:
              $ref: "#/properties/opensearch/$defs/role/properties/name"
            definition:
              $ref: "#/properties/opensearch/$defs/role/properties/definition"
      extraRoleMappings:
        title: OpenSearch Extra Role Mappings
        description: |-
          Configures extra role mappings for OpenSearch Security.

          Extra users can be configured in `secrets.yaml` under `extraUsers` and extra roles under `extraRoles`.
        type: array
        items:
          title: OpenSearch Role Mapping
          description: |-
            Configures a role mapping for OpenSearch Security.

            > [!note]
            > See [the upstream documentation](https://opensearch.org/docs/latest/security/configuration/yaml/#roles_mappingyml) for reference.
          type: object
          additionalProperties: false
          properties:
            mapping_name:
              $ref: "#/properties/opensearch/$defs/roleMapping/properties/name"
            definition:
              $ref: "#/properties/opensearch/$defs/roleMapping/properties/definition"
      indexPerNamespace:
        title: OpenSearch Index Per Namespace
        description: |-
          When enabled logs are ingested into multiple indices per namespace.
          When disabled logs are ingested into a single `kubernetes` index.

          > [!note]
          > Must be set for both service and workload cluster.
        type: boolean
        default: false
      defaultTemplates:
        title: OpenSearch Default Templates
        description: |-
          When enabled OpenSearch will be configured with the default index templates for:

          - `authlog`
          - `kubeaudit`
          - `kubernetes`
          - `other`
        type: boolean
        default: true
      overwriteTemplates:
        title: OpenSearch Overwrite Templates
        description: |-
          When set OpenSearch can be configured with index templates via `additionalTemplates` that overwrite the ones configured via `defaultTemplates`.
        type: boolean
        default: true
      additionalTemplates:
        title: OpenSearch Additional Templates
        description: |-
          When set OpenSearch will be configured with additional index templates.

          The keys will be used as the name of the index templates.

          > [!note]
          > See [the upstream documentation](https://opensearch.org/docs/latest/im-plugin/index-templates/) for reference.
        type: object
        additionalProperties:
          type: string
          format: json
      createIndices:
        title: OpenSearch Create Indices
        description: |-
          When enabled OpenSearch will be configured with initial indices for:

          - `authlog`
          - `kubeaudit`
          - `kubernetes`
          - `other`
        type: boolean
        default: true
      ism:
        title: OpenSearch Index State Management
        description: Configures index state management in OpenSearch.
        type: object
        additionalProperties: false
        properties:
          defaultPolicies:
            title: OpenSearch Default Policies
            description: |-
              When enabled OpenSearch will be configured with the default index state management policies for:

              - `authlog`
              - `kubeaudit`
              - `kubernetes`
              - `other`
            type: boolean
            default: true
          overwritePolicies:
            title: OpenSearch Overwrite Policies
            description: |-
              When set OpenSearch can be configured with index state management policies via `additionalPolicies` that overwrite the ones configured via `defaultPolicies`.
            type: boolean
            default: true
          additionalPolicies:
            title: OpenSearch Additional Policies
            description: |-
              When set OpenSearch will be configured with additional index state management policies.

              The keys will be used as the name of the index state management policy.

              > [!note]
              > See [the upstream documentation](https://opensearch.org/docs/latest/im-plugin/ism/policies/) for reference.
            type: object
            additionalProperties:
              type: string
              format: json
          rolloverAgeDays:
            title: OpenSearch Rollover Age Days
            description: Configures the age a write index must reach before it is rolled over to a new one.
            type: number
            default: 1
          rolloverSizeGB:
            title: OpenSearch Rollover Size GB
            description: Configures the size a write index must reach before it is rolled over to a new one.
            type: number
            default: 1
      ingress:
        title: OpenSearch Ingress
        description: Configures the ingress for OpenSearch master or client nodes.
        type: object
        additionalProperties: false
        properties:
          maxbodysize:
            title: OpenSearch Ingress Max Body
            type: string
            default: 32m
      maxClauseCount:
        title: OpenSearch Maximum Clause Count
        description: Configures the maximum number of clauses permitted in a query.
        type: number
        default: 1024
      maxShardsPerNode:
        title: OpenSearch Maximum Shards Per Node
        description: Configures the maximum number of shards permitted on one node.
        type: number
        default: 1000
      curator:
        title: OpenSearch Curator
        description: Configures the CronJob that removes indices.
        type: object
        additionalProperties: false
        properties:
          enabled:
            title: OpenSearch Curator Enabled
            type: boolean
            default: true
          retention:
            title: OpenSearch Curator Retention
            description: Configures the retention of indices in OpenSearch.
            type: array
            items:
              title: OpenSearch Curator Retention
              description: Configures the retention of indices in OpenSearch.
              additionalProperties: false
              type: object
              properties:
                pattern:
                  title: OpenSearch Curator Index Pattern
                  type: string
                ageDays:
                  title: OpenSearch Curator Index Age Days
                  type: number
                sizeGB:
                  title: OpenSearch Curator Index Pattern Size GB
                  description: |-
                    > [!note]
                    > This is evaluated against the entire index pattern.
                  type: number
            default:
              - pattern: authlog-*
                ageDays: 30
                sizeGB: 1
              - pattern: kubeaudit-*
                ageDays: 30
                sizeGB: 50
              - pattern: kubernetes-*
                ageDays: 30
                sizeGB: 50
              - pattern: other-*
                ageDays: 7
                sizeGB: 1
              - pattern: security-auditlog-*
                ageDays: 7
                sizeGB: 1
          startingDeadlineSeconds:
            title: OpenSearch Curator Starting Deadline Seconds
            type: number
            default: 600
          activeDeadlineSeconds:
            title: OpenSearch Curator Active Deadline Seconds
            type: number
            default: 2700
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
          nodeSelector:
            $ref: '#/$defs/kubernetesNodeSelector'
          affinity:
            $ref: '#/$defs/io.k8s.api.core.v1.Affinity'
      snapshot:
        title: OpenSearch Snapshot
        description: |-
          Configures the CronJob and repository to take snapshots in OpenSearch.

          This requires that `objectStorage` is configured, and will use the bucket or container set in `objectStorage.buckets.opensearch`.
        type: object
        additionalProperties: false
        properties:
          enabled:
            title: OpenSearch Snapshot Enabled
            type: boolean
            default: true
          repository:
            title: OpenSearch Snapshot Repository
            type: string
            default: opensearch-snapshots
          ageSeconds:
            default: 864000
            type: number
          min:
            title: OpenSearch Minimum Retained Snapshots
            type: number
            default: 7
          max:
            title: OpenSearch Maximum Retained Snapshots
            default: 14
            type: number
          maxRequestSeconds:
            type: number
            default: 1200
          backupSchedule:
            title: OpenSearch Backup CronJob Schedule
            type: string
            default: 0 */2 * * *
          backupStartingDeadlineSeconds:
            title: OpenSearch Backup Job Starting Deadline
            type: number
            default: 600
          backupActiveDeadlineSeconds:
            title: OpenSearch Backup Job Active Deadline
            type: number
            default: 600
          retentionSchedule:
            title: OpenSearch Retention CronJob Schedule
            type: string
            default: '@daily'
          retentionStartingDeadlineSeconds:
            title: OpenSearch Retention Job Starting Deadline
            type: number
            default: 600
          retentionActiveDeadlineSeconds:
            title: OpenSearch Retention Job Active Deadline
            type: number
            default: 2700
          retentionResources:
            $ref: '#/$defs/kubernetesResourceRequirements'
      securityadmin:
        title: OpenSearch Security Admin
        description: Configures the Job that initialises OpenSearch Security.
        type: object
        additionalProperties: false
        properties:
          enabled:
            title: OpenSearch Security Admin Enabled
            type: boolean
            default: true
          activeDeadlineSeconds:
            title: OpenSearch Security Admin Active Deadline Seconds
            type: number
            default: 1200
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
      exporter:
        title: OpenSearch Exporter
        description: Configures the exporter exposing metrics from OpenSearch.
        type: object
        additionalProperties: false
        properties:
          serviceMonitor:
            title: OpenSearch Exporter Service Monitor
            description: Configures the service monitor of the exporter.
            type: object
            additionalProperties: false
            properties:
              interval:
                title: Scrape interval for the service monitor.
                type: string
                default: 30s
              scrapeTimeout:
                title: Scrape timeout for the service monitor.
                type: string
                default: 30s
          resources:
            $ref: '#/$defs/kubernetesResourceRequirements'
          tolerations:
            $ref: '#/$defs/kubernetesTolerations'
      promIndexAlerts:
        title: OpenSearch Prometheus Index Alerts
        description: Configures the index alerts monitoring the function of index state management.
        type: array
        items:
          title: OpenSearch Prometheus Index Alert
          description: Configures the index alert monitoring the function of index state management.
          type: object
          additionalProperties: false
          properties:
            prefix:
              title: OpenSearch Index Prefix
              type: string
            alertSizeMB:
              title: OpenSearch Index Alert Size
              type: number
        default:
          - prefix: authlog-default
            alertSizeMB: 2
          - prefix: kubeaudit-default
            alertSizeMB: 5500
          - prefix: kubernetes-default
            alertSizeMB: 5500
          - prefix: other-default
            alertSizeMB: 400
      plugins:
        title: OpenSearch Plugins
        description: Configures plugins used in OpenSearch.
        additionalProperties: false
        properties:
          installExternalObjectStoragePlugin:
            title: OpenSearch Install External Object Storage Plugin
            description: |-
              When enabled OpenSearch will install the required object storage plugin when it starts.

              In an air-gapped environment where the nodes are not connected to the Internet, set this to `false` to prevent downloading any external object storage plugins.
            type: boolean
          additionalPlugins:
            title: OpenSearch Install Additional Plugins
            description: |-
              Configures OpenSearch to install plugins when it starts.

              In an air-gapped environment this can be used to install plugins from known sources.
            type: array
        type: object
    required:
      - enabled
      - subdomain
      - dashboards
      - indexPerNamespace
additionalProperties:
  type: object
  properties: {}
